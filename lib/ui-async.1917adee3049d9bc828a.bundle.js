(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{45:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var s=a(0);a(34);const i={card:"mdc-card mdc-card--outlined",actions:"mdc-card__actions",actionButtons:"mdc-card__action-buttons",actionIcons:"mdc-card__action-icons",iconAction:["fa","mdc-icon-button","mdc-card__action","mdc-card__action--icon"].join(" "),buttonAction:"mdc-button mdc-card__action mdc-card__action--button",buttonActionRipple:"mdc-button__ripple",buttonActionIcon:"fa fa-fw mdc-button__icon",buttonActionLabel:"mdc-button__label"};function n(t,e){return Object(s.a)("div",{className:`${i.card} ${t}`},e)}var o;(o=n||(n={})).actions=function(t){const e=Object(s.a)("div",{className:i.actions});return t.buttons&&e.append(Object(s.a)("div",{className:i.actionButtons},t.buttons)),t.icons&&e.append(Object(s.a)("div",{className:i.actionIcons},t.icons)),e},o.buttonAction=function(t,e){return Object(s.a)("button",{className:i.buttonAction},[Object(s.a)("div",{className:i.buttonActionRipple}),Object(s.a)("i",{className:i.buttonActionIcon,innerHTML:t}),Object(s.a)("span",{className:i.buttonActionLabel,innerHTML:e})])},o.iconAction=function(t,e){return Object(s.a)("button",{className:i.iconAction,title:e,innerHTML:t})}},53:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var s=a(0);const i={textField:["mdc-text-field","mdc-text-field--outlined"].join(" "),textfieldTextarea:["mdc-text-field--textarea","mdc-text-field--fullwidth"].join(" "),textFieldWitchIcon:"mdc-text-field--with-leading-icon",textFieldIcon:["fa","mdc-text-field__icon","mdc-text-field__icon--leading"].join(" "),input:"mdc-text-field__input",outline:"mdc-notched-outline",outlineLeading:"mdc-notched-outline__leading",outlineNotch:"mdc-notched-outline__notch",label:"mdc-floating-label",outlineTrailing:"mdc-notched-outline__trailing",helper:"mdc-text-field-helper-line",helperText:"mdc-text-field-helper-text mdc-text-field-helper-text--persistent"};function n(t){let e=i.textField;const a=[Object(s.a)("div",{className:i.outline},[Object(s.a)("div",{className:i.outlineLeading}),Object(s.a)("div",{className:i.outlineNotch},[Object(s.a)("span",{className:i.label,id:t.id,innerHTML:t.label})]),Object(s.a)("div",{className:i.outlineTrailing})])];return t.textarea?(e+=" "+i.textfieldTextarea,a.push(Object(s.a)("textarea",{className:i.input,id:t.id,rows:8,cols:80}))):(t.icon&&(e+=" "+i.textFieldWitchIcon,a.push(Object(s.a)("i",{className:i.textFieldIcon,innerHTML:t.icon}))),a.push(Object(s.a)("input",{type:t.inputType,className:i.input,ariaLabelledby:t.id}))),Object(s.a)("div",{className:e},a)}(n||(n={})).helper=function(t){return Object(s.a)("div",{className:i.helper},[Object(s.a)("div",{className:i.helperText},t)])}},66:function(t,e,a){"use strict";a.r(e);var s,i=a(44),n=a.n(i),o=a(0),r=a(6),c=a(46),l=a.n(c),d=a(45);!function(t){class e extends r.a.Prototype{constructor(){super(),this.root=null,Object.defineProperty(this,"root",{enumerable:!1})}update(t){}updateStyle(){}setVisible(t){if(!this.root){if(!t)return;this.render()}this.root.hidden=!t}}t.CardPrototype=e;t.ChartCardProtorype=class extends e{constructor(){super(...arguments),this.chart=null}},t.eliChartCard=function(t,e,a){return Object(d.a)(t,[Object(o.a)("div",{className:"content"},[Object(o.a)("span",{className:"title",innerHTML:e}),Object(o.a)("div",{className:"chart-container"},[a])])])},t.fillTimeDataMap=function(t,e,a){let s=e;for(;s<=a;){const e=l()(s+1e3).startOf("month"),a=e.valueOf();t.has(a)||t.set(a,0),s=e.endOf("month").valueOf()}}}(s||(s={}));var h,u=a(4),p=a(14),m=a(7);!function(t){class e extends s.CardPrototype{updateStats(t){}}t.CardPrototype=e;t.ChartCardPrototype=class extends e{constructor(){super(...arguments),this.chart=null}},t.eliChartCard=s.eliChartCard,t.fillTimeDataMap=s.fillTimeDataMap}(h||(h={}));const b="ui.dashboard.brainstorming.basic",f={title:b+".title",desc:b+".desc",refresh:b+".refresh",clear:b+".clear"};class g extends h.CardPrototype{constructor(){super(...arguments),this.actionRefresh=null,this.events={refresh:()=>{},clear:()=>{}}}render(){this.actionRefresh=d.a.buttonAction(m.a.Icon.syncAlt,u.a.t(f.refresh));const t=new p.a(this.actionRefresh);t.unbounded=!0,t.listen("click",(()=>{this.actionRefresh.disabled=!0,this.events.refresh()}));const e=d.a.iconAction(m.a.Icon.trash,u.a.t(f.clear)),a=new p.a(e);a.unbounded=!0,a.listen("click",(()=>{this.events.clear()})),this.root=Object(d.a)("bs-basic-card",[Object(o.a)("div",{className:"content"},[Object(o.a)("span",{className:"title",innerHTML:u.a.t(f.title)}),Object(o.a)("span",{className:"count",innerHTML:"0"}),Object(o.a)("span",{className:"desc",innerHTML:u.a.t(f.desc,{count:0})})]),d.a.actions({buttons:[this.actionRefresh],icons:[e]})]),this.setVisible(!1),this.parent.append(this.root)}updateStats(t){this.root.querySelector(".count").innerHTML=""+t.review,this.root.querySelector(".desc").innerHTML=u.a.t(f.desc,{count:t.nomination}),this.actionRefresh.disabled=!1}}var y=g,v=a(20);const j={title:"ui.dashboard.brainstorming.rates.title"};class O extends h.ChartCardPrototype{render(){const t=Object(o.a)("canvas",{});this.root=h.eliChartCard("bs-rates-card",u.a.t(j.title),t),this.setVisible(!1),this.parent.append(this.root);const e=[];for(const t of Object.values(v.a))e.push(u.a.t(t));const a=getComputedStyle(document.documentElement);this.chart=new n.a(t.getContext("2d"),{type:"radar",data:{labels:e,datasets:[{data:[],borderColor:a.getPropertyValue("--mdc-theme-primary"),pointRadius:0}]},options:{legend:{display:!1},scale:{ticks:{display:!1,min:1,max:5,stepSize:1},angleLines:{color:a.getPropertyValue("--mdc-theme-text-disabled-on-light")},gridLines:{color:a.getPropertyValue("--mdc-theme-text-disabled-on-light")}}}})}updateStats(t){const e=[];for(const a of Object.keys(v.a)){const s=t.rate.get(a),i=s.reduce(((t,e)=>t+e),0)/s.length;e.push(parseFloat(i.toFixed(2)))}this.chart.data.datasets[0].data=e,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].borderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.options.scale.angleLines.color=t.getPropertyValue("--mdc-theme-text-disabled-on-light"),this.chart.options.scale.gridLines.color=t.getPropertyValue("--mdc-theme-text-disabled-on-light"),this.chart.update()}}var C=O;const w={title:"ui.dashboard.brainstorming.reviews.title",desc:"ui.dashboard.brainstorming.reviews.desc"};class x extends h.ChartCardPrototype{render(){const t=Object(o.a)("canvas",{});this.root=h.eliChartCard("bs-reviews-card",u.a.t(w.title),t),this.setVisible(!1),this.parent.append(this.root);const e=getComputedStyle(document.documentElement);this.chart=new n.a(t.getContext("2d"),{type:"line",data:{labels:[],datasets:[{label:u.a.t(w.desc),data:[],borderColor:e.getPropertyValue("--mdc-theme-primary"),pointRadius:0}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{type:"time",time:{unit:"month",tooltipFormat:"YYYY-MM",displayFormats:{month:"YYYY-MM"}}}]}}})}updateStats(t){if(t.reviewTimes.length<1)return this.chart.data.datasets[0].data=[],void this.chart.update();const e=new Map;let a=l()(t.reviewTimes[0]).startOf("month").valueOf(),s=a;for(const i of t.reviewTimes){const t=l()(i).startOf("month").valueOf();t<a?a=t:t>s&&(s=t),e.has(t)?e.set(t,e.get(t)+1):e.set(t,1)}h.fillTimeDataMap(e,a,s);const i=[];e.forEach(((t,e)=>{i.push({t:e,y:t})})),i.sort(((t,e)=>t.t-e.t)),this.chart.data.datasets[0].data=i,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].borderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.update()}}var S=x;const T={title:"ui.dashboard.brainstorming.synch.title",desc:"ui.dashboard.brainstorming.synch.desc"};class k extends h.ChartCardPrototype{render(){this.root=Object(d.a)("bs-synch-card",[Object(o.a)("div",{className:"content"},[Object(o.a)("span",{className:"title",innerHTML:u.a.t(T.title)}),Object(o.a)("span",{className:"synch"},[Object(o.a)("span",{className:"number",innerHTML:"0.0"}),Object(o.a)("span",{className:"percent",innerHTML:"%"})]),Object(o.a)("span",{className:"desc",innerHTML:u.a.t(T.desc)})])]),this.setVisible(!1),this.parent.append(this.root)}updateStats(t){const e=t.synch.total>0?t.synch.synched/t.synch.total:0;this.root.querySelector(".number").innerHTML=""+(100*e).toFixed(1)}}var L=k;class _ extends s.CardPrototype{constructor(){super(),this.basic=new y,this.rates=new C,this.synch=new L,this.reviews=new S,this.events={analyse:()=>({review:0,nomination:0,rate:new Map,reviewTimes:[],synch:{total:0,synched:0}})},Object.defineProperty(this,"events",{enumerable:!1})}init(t){this.forEach((e=>{e.init(t)}))}update(t){const e=this.events.analyse(t);this.forEach((t=>{t.updateStats(e)}))}updateStyle(){this.forEach((t=>{t.updateStyle()}))}setVisible(t){this.forEach((e=>{e.setVisible(t)}))}forEach(t){Object.values(this).forEach(t)}}var M=_;const N={title:"ui.dashboard.count-by-month.title",submissions:"ui.dashboard.count-by-month.submissions",results:"ui.dashboard.count-by-month.results"};class P extends s.ChartCardProtorype{render(){const t=Object(o.a)("canvas",{});this.root=s.eliChartCard("count-by-month-card",u.a.t(N.title),t),this.setVisible(!1),this.parent.append(this.root);const e=getComputedStyle(document.documentElement),a=e.getPropertyValue("--mdc-theme-primary"),i=e.getPropertyValue("--mdc-theme-secondary");this.chart=new n.a(t.getContext("2d"),{type:"line",data:{labels:[],datasets:[{label:u.a.t(N.submissions),data:[],borderColor:a,pointBackgroundColor:a,pointRadius:0,fill:!1},{label:u.a.t(N.results),data:[],borderColor:i,pointBackgroundColor:i,pointRadius:0,fill:!1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{type:"time",time:{unit:"month",tooltipFormat:"YYYY-MM",displayFormats:{month:"YYYY-MM"}}}]},tooltips:{mode:"x"}}})}update(t){if(0===t.length)return this.chart.data.datasets[0].data=[],this.chart.data.datasets[1].data=[],void this.chart.update();const e=new Map,a=new Map;let i=l()(t[0].confirmedTime).startOf("month").valueOf(),n=i;for(const s of t){if(s.confirmedTime>0){const t=l()(s.confirmedTime).startOf("month").valueOf();t<i?i=t:t>n&&(n=t),e.has(t)?e.set(t,e.get(t)+1):e.set(t,1)}if(s.resultTime>0){const t=l()(s.resultTime).startOf("month").valueOf();t>n&&(n=t),a.has(t)?a.set(t,a.get(t)+1):a.set(t,1)}}s.fillTimeDataMap(e,i,n),s.fillTimeDataMap(a,i,n);const o=[],r=[];e.forEach(((t,e)=>{o.push({t:e,y:t})})),a.forEach(((t,e)=>{r.push({t:e,y:t})})),o.sort(((t,e)=>t.t-e.t)),r.sort(((t,e)=>t.t-e.t)),this.chart.data.datasets[0].data=o,this.chart.data.datasets[1].data=r,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].borderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.data.datasets[1].borderColor=t.getPropertyValue("--mdc-theme-secondary"),this.chart.update()}}var R=P,D=a(75),I=a(1);const A={title:"ui.dashboard.filter.title",rejected:"ui.dashboard.filter.rejected"},H="mdc-switch",V="mdc-switch__track",E="mdc-switch__thumb-underlay",F="mdc-switch__thumb",B="mdc-switch__native-control";class q extends s.CardPrototype{constructor(){super(...arguments),this.status=new Map,this.reason=new Map,this.events={switched:()=>{}}}render(){const t=Object(o.a)("div",{className:"status-box"}),e=Object(o.a)("div",{className:"reason-box"});this.root=Object(d.a)("filter-card",[Object(o.a)("div",{className:"content"},[Object(o.a)("span",{className:"title",innerHTML:u.a.t(A.title)}),t,Object(o.a)("span",{className:"subtitle",innerHTML:u.a.t(A.rejected)}),e])]),this.setVisible(!1),this.parent.append(this.root);for(const e of I.a.status.values()){const a=q.buildSwitch(t,e,e.code);a.listen("change",(()=>this.switchType(e.code,a.checked))),this.status.set(e.code,a)}for(const[t,a]of I.a.reason){const s=q.buildSwitch(e,a,I.a.StatusCode.Rejected);s.listen("change",(()=>{this.switchReason(s.checked)})),this.reason.set(t,s)}}switchType(t,e){let a=!1;if(t===I.a.StatusCode.Rejected){for(const t of this.reason.values())t.checked=e;a=!0}this.switch(a)}switchReason(t){t&&!this.status.get(I.a.StatusCode.Rejected).checked&&(this.status.get(I.a.StatusCode.Rejected).checked=!0),this.switch(!0)}switch(t){this.events.switched(this.statusFilterMap,this.reasonFilterMap,t)}get statusFilterMap(){const t=new Map;for(const[e,a]of this.status)t.set(e,a.checked);return t}get reasonFilterMap(){const t=new Map;for(const[e,a]of this.reason)t.set(e,a.checked);return t}static buildSwitch(t,e,a){const s="switch-filter-"+e.code,i=function(t){return Object(o.a)("div",{className:H},[Object(o.a)("div",{className:V}),Object(o.a)("div",{className:E},[Object(o.a)("div",{className:F}),Object(o.a)("input",{type:"checkbox",className:B,id:t,role:"switch"})])])}(s),n=Object(o.a)("div",{},[i,Object(o.a)("label",{className:"fa fa-fw status-"+a,for:s,title:u.a.t(e.title),innerHTML:e.icon})]);t.append(n);const r=new D.a(i);return r.checked=!0,r}}var z=a(52),Y=a.n(z);a(59);class $ extends s.CardPrototype{constructor(){super(),this.ctrl=null,this.events={focus:()=>{},styleLoaded:()=>[]},this.statusFilter=new Map,this.reasonFilter=new Map,this.tasks=[];for(const t of I.a.status.keys())this.statusFilter.set(t,!0);for(const[t,e]of I.a.reason)this.reasonFilter.set(t,!0)}render(){const t=Object(o.a)("div",{});this.root=Object(d.a)("map-card",[t]),this.parent.append(this.root),Y.a.accessToken="pk.eyJ1IjoibHVja2EtbWUiLCJhIjoiY2p2NDk5NmRvMHFreTQzbzduemM1MHV4cCJ9.7XGmxnEJRoCDr-i5BBmBfw",this.ctrl=new Y.a.Map({container:t,style:$.getStyle()}),this.ctrl.on("idle",(()=>this.executeTasks())),this.ctrl.addControl(new Y.a.NavigationControl),this.ctrl.addControl(new Y.a.FullscreenControl),this.resize()}get loaded(){return this.ctrl&&this.ctrl.isStyleLoaded()}update(t){this.loaded?(this.updateRejected(t),this.updateSource(I.a.StatusCode.Accepted,this.generateGeoJSON(t,I.a.StatusCode.Accepted)),this.updateSource(I.a.StatusCode.Pending,this.generateGeoJSON(t,I.a.StatusCode.Pending))):this.tasks.push((()=>this.update(t)))}updateStyle(){this.loaded?(this.ctrl.setStyle($.getStyle()),this.update(this.events.styleLoaded())):this.tasks.push((()=>this.updateStyle()))}filter(t,e){if(this.statusFilter=t,this.reasonFilter=e,this.loaded)for(const[t,e]of this.statusFilter){const a=e?"visible":"none";this.ctrl.setLayoutProperty(`potori-${t}-cluster`,"visibility",a),this.ctrl.setLayoutProperty(`potori-${t}-count`,"visibility",a),this.ctrl.setLayoutProperty(`potori-${t}-unclustered`,"visibility",a)}else this.tasks.push((()=>this.filter(t,e)))}easeTo(t){if(!this.loaded)return void this.tasks.push((()=>this.easeTo(t)));const e=this.ctrl.getZoom();this.ctrl.easeTo({center:t,zoom:e<15?15:e})}resize(){this.loaded?this.ctrl.resize():this.tasks.push((()=>this.resize()))}fit(t){if(!this.loaded)return void this.tasks.push((()=>this.fit(t)));const e={lng:-181,lat:-91},a={lng:181,lat:91};for(const s of t)s.lngLat&&(s.lngLat.lng>e.lng&&(e.lng=s.lngLat.lng),s.lngLat.lng<a.lng&&(a.lng=s.lngLat.lng),s.lngLat.lat>e.lat&&(e.lat=s.lngLat.lat),s.lngLat.lat<a.lat&&(a.lat=s.lngLat.lat));a.lng>-181&&this.ctrl.fitBounds([a,e],{linear:!0})}updateRejected(t){this.loaded?this.updateSource(I.a.StatusCode.Rejected,this.generateGeoJSON(t,I.a.StatusCode.Rejected)):this.tasks.push((()=>this.updateRejected(t)))}executeTasks(){const t=this.tasks.length;for(let e=0;e<t;e++)this.tasks.shift()()}updateSource(t,e){const a="potori-"+t,s=this.ctrl.getSource(a);if(s)return void s.setData(e);this.ctrl.addSource(a,{type:"geojson",data:e,cluster:!0});const i=getComputedStyle(document.documentElement),n=i.getPropertyValue("--color-"+t),o=i.getPropertyValue(`--color-${t}--dark`);this.ctrl.addLayer({id:a+"-cluster",type:"circle",source:a,filter:["has","point_count"],paint:{"circle-color":n,"circle-opacity":.6,"circle-stroke-width":4,"circle-stroke-color":o,"circle-radius":["step",["get","point_count"],20,50,30,100,40]}}),this.ctrl.addLayer({id:a+"-count",type:"symbol",source:a,filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":getComputedStyle(document.documentElement).getPropertyValue("--mdc-theme-on-surface")}}),this.ctrl.addLayer({id:a+"-unclustered",type:"circle",source:a,filter:["!",["has","point_count"]],paint:{"circle-color":n,"circle-radius":5,"circle-stroke-width":2,"circle-stroke-color":o}}),this.ctrl.on("click",a+"-cluster",(t=>{const e=this.ctrl.queryRenderedFeatures(t.point,{layers:[a+"-cluster"]}),s=e[0].properties.cluster_id;this.ctrl.getSource(a).getClusterExpansionZoom(s,((t,a)=>{t||this.ctrl.easeTo({center:e[0].geometry.coordinates,zoom:a})}))})),this.ctrl.on("click",a+"-unclustered",(t=>{t.features[0].geometry.coordinates;const e=t.features[0].geometry.coordinates;for(;Math.abs(t.lngLat.lng-e[0])>180;)e[0]+=t.lngLat.lng>e[0]?360:-360;(new Y.a.Popup).setLngLat(e).setText(t.features[0].properties.title).addTo(this.ctrl),this.events.focus(t.features[0].properties.id)}))}generateGeoJSON(t,e){const a={type:"FeatureCollection",features:[]};let s=e===I.a.StatusCode.Rejected&&this.reasonFilter.get(I.a.Reason.undeclared);for(const i of t)if(i.status===e&&i.lngLat){if(e===I.a.StatusCode.Rejected)if(i.reasons.length>0){let t=!1;for(const e of i.reasons)if(this.reasonFilter.get(e)){t=!0;break}if(!t)continue}else if(!s)continue;a.features.push({type:"Feature",properties:{id:i.id,title:i.title,status:i.status},geometry:{type:"Point",coordinates:[i.lngLat.lng,i.lngLat.lat]}})}return a}static getStyle(){return`mapbox://styles/mapbox/${getComputedStyle(document.documentElement).getPropertyValue("--map-style").trim()}?optimize=true`}}var J=$;const U={title:"ui.dashboard.quotas.title",xAxis:"ui.dashboard.quotas.xAxis"};class W extends s.ChartCardProtorype{render(){const t=Object(o.a)("canvas",{});this.root=s.eliChartCard("quotas-card",u.a.t(U.title),t),this.setVisible(!1),this.parent.append(this.root);const e=[];for(let t=0;t<14;t++)e.push(""+t);const a=getComputedStyle(document.documentElement);this.chart=new n.a(t.getContext("2d"),{type:"bar",data:{labels:e,datasets:[{data:[],backgroundColor:a.getPropertyValue("--mdc-theme-primary"),hoverBackgroundColor:a.getPropertyValue("--mdc-theme-primary")}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{scaleLabel:{display:!0,labelString:u.a.t(U.xAxis)}}]}}})}update(t){const e=new Array(14).fill(0),a=Date.now();for(const s of t){const t=s.restoreTime;t>a&&(e[Math.floor((t-a)/864e5)]+=1)}this.chart.data.datasets[0].data=e,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].backgroundColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.data.datasets[0].hoverBackgroundColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.update()}}var G=W;const Z={title:"ui.dashboard.stats-reasons.title"};class K extends s.ChartCardProtorype{render(){const t=Object(o.a)("canvas",{});this.root=s.eliChartCard("stats-reasons-card",u.a.t(Z.title),t),this.setVisible(!1),this.parent.append(this.root),this.chart=new n.a(t.getContext("2d"),{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],borderAlign:"inner",borderColor:"rgba(0, 0, 0, 0.2)",hoverBackgroundColor:[],hoverBorderColor:"rgba(0, 0, 0, 0.4)"}]},options:{legend:{display:!0,position:"right"}}})}update(t){const e=new Map;for(const t of I.a.reason.keys())e.set(t,0);t.reduce(((t,e)=>{if(e.status!==I.a.StatusCode.Rejected)return t;if(e.reasons.length>0)for(const a of e.reasons)t.set(a,t.get(a)+1);else{const e=I.a.Reason.undeclared;t.set(e,t.get(e)+1)}return t}),e);const a=[],s=[],i=[];for(const[t,n]of e.entries()){if(n<1)continue;const e=I.a.reason.get(t);a.push(u.a.t(e.title)),s.push(e.color),i.push(n)}this.chart.data.labels=a,this.chart.data.datasets[0].data=i,this.chart.data.datasets[0].backgroundColor=s,this.chart.data.datasets[0].hoverBackgroundColor=s,this.chart.update()}}var Q=K;const X={title:"ui.dashboard.stats-status.title"};class tt extends s.ChartCardProtorype{render(){const t=Object(o.a)("canvas",{});this.root=s.eliChartCard("stats-status-card",u.a.t(X.title),t),this.setVisible(!1),this.parent.append(this.root),this.chart=new n.a(t.getContext("2d"),{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],borderAlign:"inner",borderColor:"rgba(0, 0, 0, 0.2)",hoverBackgroundColor:[],hoverBorderColor:"rgba(0, 0, 0, 0.4)"}]},options:{legend:{display:!0,position:"right"}}})}update(t){const e=new Map;for(const t of I.a.status.keys())e.set(t,0);t.reduce(((t,e)=>(t.set(e.status,t.get(e.status)+1),t)),e);const a=[],s=[],i=[],n=getComputedStyle(document.documentElement);for(const[t,o]of e.entries()){if(o<1)continue;const e=I.a.status.get(t);a.push(u.a.t(e.title)),s.push(n.getPropertyValue("--color-"+e.code)),i.push(o)}this.chart.data.labels=a,this.chart.data.datasets[0].data=i,this.chart.data.datasets[0].backgroundColor=s,this.chart.data.datasets[0].hoverBackgroundColor=s,this.chart.update()}}var et=tt;class at extends r.a.Prototype{constructor(){super(),this.root=null,this.map=new J,this.filter=new q,this.statsStatus=new et,this.statsReasons=new Q,this.countByMonth=new R,this.quotas=new G,this.bs=new M,Object.defineProperty(this,"root",{enumerable:!1})}init(t){super.init(t),n.a.defaults.global.legend.labels.boxWidth=10,n.a.defaults.global.maintainAspectRatio=!1,n.a.defaults.line.tooltips={intersect:!1},n.a.defaults.doughnut.tooltips={callbacks:{label:(t,e)=>{const a=e.datasets[t.datasetIndex],s=a._meta,i=s[Object.keys(s)[0]].data,n=a.data.reduce(((t,e,a)=>t+(i[a].hidden?0:e)),0),o=a.data[t.index],r=(o/n*100).toFixed(2);return`${e.labels[t.index]}: ${o} (${r}%)`}}},n.a.defaults.radar.tooltips={intersect:!1,callbacks:{title:(t,e)=>e.labels[t[0].index]}},this.render(),this.forEach((t=>{t.init(this.root)}))}render(){this.root=Object(o.a)("div",{className:"dashboard"}),this.parent.append(this.root)}refresh(t){this.forEach((e=>{e.update(t)}))}update(t){this.map.update(t),this.statsStatus.update(t),this.statsReasons.update(t),this.countByMonth.update(t),this.bs.update(t)}updateStyle(){this.forEach((t=>{t.updateStyle()}))}setVisible(t){this.forEach((e=>{e.setVisible(t)})),this.map.resize()}switchView(){this.root.classList.toggle("view-hide")}forEach(t){Object.values(this).forEach(t)}}e.default=at},69:function(t,e,a){"use strict";a.r(e);var s=a(4),i=a(0),n=a(70),o=a(41),r=a(77),c=a(76),l=a(67);function d(t,e,a){let s=document.createElementNS("http://www.w3.org/2000/svg",t);if(e)for(const[t,a]of Object.entries(e))if("style"===t)for(const[t,e]of Object.entries(a))s.style[t]=e;else if("dataset"===t)for(const[t,e]of Object.entries(a))s.dataset[t]=e;else s.setAttributeNS(null,t,a);return a&&s.append(...a),s}const h="mdc-chip",u="mdc-chip__ripple",p="mdc-chip__checkmark",m="mdc-chip__checkmark-svg",b="mdc-chip__checkmark-path",f="mdc-chip__primary-action",g="mdc-chip__text",y="mdc-chip-set mdc-chip-set--filter";var v=a(11),j=a(7);const O="mdc-radio",C="mdc-radio__native-control",w="mdc-radio__background",x="mdc-radio__outer-circle",S="mdc-radio__inner-circle";function T(t,e,a,s){const n=Object(i.a)("input",{type:"radio",className:C,id:t,name:e,value:a});return n.addEventListener("change",(t=>{const e=t.target;s(e.value)})),Object(i.a)("div",{className:O},[n,Object(i.a)("div",{className:w},[Object(i.a)("div",{className:x}),Object(i.a)("div",{className:S})])])}(T||(T={})).form=function(t,e,a,s){return Object(i.a)("div",{className:"mdc-form-field"},[t,Object(i.a)("label",{for:a,className:s||"",innerHTML:e})])};var k=a(53),L=a(10),_=a(1);const M="ui.dialog.details",N="save",P={resultTime:M+".resultTime",reason:M+".reason",save:M+".save",messageInvalidTime:`message:${M}.invalidTime`};var R=a(52),D=a.n(R),I=a(14),A=a(6),H=a(21);class V extends A.a.Prototype{constructor(){super(...arguments),this.ctrl=null,this.marker=null,this.buttons={edit:{ctrl:null,icon:j.a.Icon.edit,clicked:()=>this.edit()},search:{ctrl:null,icon:j.a.Icon.search,clicked:()=>this.search()},delete:{ctrl:null,icon:j.a.Icon.trash,clicked:()=>this.delete()}},this.opened=!1,this.events={alert:()=>{},queryLngLat:()=>{}}}init(t){super.init(t),this.render()}render(){const t=Object(i.a)("div",{className:"map"});this.parent.append(Object(i.a)("div",{className:"details-map"},[Object(i.a)("div",{className:"buttons"},Object.values(this.buttons).map((t=>{const e=Object(H.a)(t.icon);return t.ctrl=new I.a(e),t.ctrl.unbounded=!0,t.ctrl.listen("click",t.clicked),e}))),t])),this.ctrl=new D.a.Map({container:t,style:V.style}),this.ctrl.addControl(new D.a.NavigationControl)}updateStyle(){this.ctrl&&this.ctrl.setStyle(V.style)}set lngLat(t){this.delete(),t&&a.e(0).then(a.t.bind(null,52,7)).then((e=>{this.marker=(new e.Marker).setLngLat(t).addTo(this.ctrl),this.ctrl.jumpTo({center:t,zoom:16}),this.buttons.delete.ctrl.disabled=!1,this.buttons.edit.ctrl.root.innerHTML=j.a.Icon.edit})),this.buttons.search.ctrl.disabled=!1}get lngLat(){return this.marker?this.marker.getLngLat():null}layout(){this.ctrl.resize();for(const t of Object.values(this.buttons))t.ctrl.layout()}edit(){this.marker?this.marker.setDraggable(!0):a.e(0).then(a.t.bind(null,52,7)).then((t=>{this.marker=(new t.Marker).setLngLat(this.ctrl.getCenter()).setDraggable(!0).addTo(this.ctrl),this.buttons.delete.ctrl.disabled=!1,this.buttons.edit.ctrl.root.innerHTML=j.a.Icon.edit}))}search(){this.buttons.search.ctrl.disabled=!0,this.events.queryLngLat((t=>{this.opened&&(this.marker?(this.marker.setLngLat(t),this.marker.setDraggable(!1)):a.e(0).then(a.t.bind(null,52,7)).then((e=>{this.marker=(new e.Marker).setLngLat(t).setDraggable(!1).addTo(this.ctrl)})),this.ctrl.easeTo({center:t,zoom:16}),this.buttons.edit.ctrl.root.innerHTML=j.a.Icon.edit,this.buttons.search.ctrl.disabled=!1,this.buttons.delete.ctrl.disabled=!1)}),(t=>{this.opened&&(this.events.alert(s.a.t(t)),this.buttons.search.ctrl.disabled=!1)}))}delete(){this.marker&&this.marker.remove(),this.marker=null,this.buttons.edit.ctrl.root.innerHTML=j.a.Icon.plus,this.buttons.delete.ctrl.disabled=!0}static get style(){return`mapbox://styles/mapbox/${getComputedStyle(document.documentElement).getPropertyValue("--map-style").trim()}?optimize=true`}}class E extends L.a.DialogPrototype{constructor(){super(...arguments),this._nomination=null,this.textConfirmedTime=null,this.radioStatus=new Map,this.fieldResultTime=null,this.elementReasons=null,this.chipSetReasons=null,this.map=new V,this.events={alert:()=>{},query:()=>{},update:()=>{}}}render(){const t=[];this.textConfirmedTime=Object(i.a)("span",{}),t.push(Object(i.a)("div",{className:"confirmed-time"},[Object(j.a)(j.a.Icon.arrowUp),this.textConfirmedTime]));const e=[];for(const[t,a]of _.a.status){const s="radio-dialog-details-status-"+t,i=T(s,"radio-dialog-details-status",""+t,(t=>{this.fieldResultTime.root.hidden=t===""+_.a.StatusCode.Pending,this.fieldResultTime.layout(),this.elementReasons.hidden=!(t===""+_.a.StatusCode.Rejected),this.map.layout()})),n=T.form(i,a.icon,s,"fa status-"+a.code),o=new c.a(i);this.radioStatus.set(t,o);new r.a(n).input=o,e.push(n)}t.push(Object(i.a)("div",{className:"status-form"},e));const a=Object(k.a)({id:"input-dialog-details-result-time",label:s.a.t(P.resultTime),icon:j.a.Icon.calendarAlt,inputType:"datetime-local"});a.classList.add("result-time"),t.push(a);const O=[];for(const[t,e]of _.a.reason)t!==_.a.Reason.undeclared&&O.push({id:`${E.reasonChipIdPrefix}${t}`,text:s.a.t(e.title)});const C=(w=O,Object(i.a)("div",{className:y,role:"grid"},w.map((t=>Object(i.a)("div",{className:h,id:t.id,role:"row"},[Object(i.a)("div",{className:u}),Object(i.a)("span",{className:p},[d("svg",{class:m,viewBox:"-2 -3 30 30"},[d("path",{class:b,fill:"none",stroke:"black",d:"M1.73,12.91 8.1,19.28 22.79,4.59"})])]),Object(i.a)("span",{role:"gridcell"},[Object(i.a)("span",{className:f,role:"button"},[Object(i.a)("span",{className:g,innerHTML:t.text})])])])))));var w;this.chipSetReasons=new n.a(C),this.elementReasons=Object(i.a)("div",{className:"reason-selector"},[C]),t.push(this.elementReasons);const x=Object(v.a)("details-dialog",{title:" ",contents:t,actions:[{action:L.a.Action.close,text:s.a.t(L.a.StringKey.close)},{action:N,text:s.a.t(P.save)}]});this.parent.append(x);const S=x.querySelector(".mdc-dialog__content");x.querySelector(".mdc-dialog__surface").insertBefore(Object(i.a)("img",{}),S),this.map.init(S),this.map.events.alert=t=>this.events.alert(t),this.map.events.queryLngLat=(t,e)=>{this.events.query(this._nomination,(e=>t({lng:parseFloat(e.lng),lat:parseFloat(e.lat)})),e)},this.fieldResultTime=new l.a(a),this.ctrl=new o.a(x),this.ctrl.listen("MDCDialog:opened",(()=>this.opened())),this.ctrl.listen("MDCDialog:closed",(t=>this.closed(t)))}updateStyle(){this.map.updateStyle()}set nomination(t){this.ctrl||this.render(),this._nomination=t,this.map.lngLat=t.lngLat,this.ctrl.root.querySelector(".mdc-dialog__title").innerHTML=t.title,this.ctrl.root.querySelector("img").src=t.imageUrl,this.textConfirmedTime.innerHTML=new Date(t.confirmedTime).toLocaleString(),this.fieldResultTime.root.hidden=t.status===_.a.StatusCode.Pending;const e=t=>{const e=new Date;return e.setTime(t-6e4*e.getTimezoneOffset()),e.toISOString()},a=e(t.resultTime?t.resultTime:Date.now());if(this.fieldResultTime.value=a.slice(0,a.lastIndexOf(":")),this.elementReasons.hidden=!(t.status===_.a.StatusCode.Rejected),t.status===_.a.StatusCode.Rejected){const e=t.reasons.map((t=>`${E.reasonChipIdPrefix}${t}`));this.chipSetReasons.chips.forEach((t=>{t.selected=e.includes(t.id)}))}else this.chipSetReasons.chips.forEach((t=>t.selected=!1));t.status===_.a.StatusCode.Pending&&this.events.query(t,(t=>{const a=e(t.lastTime);this.fieldResultTime.value=a.slice(0,a.lastIndexOf(":")),this.fieldResultTime.layout()}),(()=>{})),this.radioStatus.get(t.status).checked=!0}opened(){this.fieldResultTime.layout(),this.map.layout(),this.map.opened=!0}closed(t){if(this.map.opened=!1,t.detail.action!==N)return;let e=!1,a=_.a.StatusCode.Pending;for(const[t,e]of this.radioStatus)if(!e.checked){a=t;break}if(a!==_.a.StatusCode.Pending){const t=Date.parse(this.fieldResultTime.value);if(!t)return void this.events.alert(s.a.t(P.messageInvalidTime));const a=t+6e4*(new Date).getTimezoneOffset();this._nomination.resultTime&&Math.floor(this._nomination.resultTime/6e4)===Math.floor(a/6e4)||(this._nomination.resultTime=a,e=!0)}if(a!==this._nomination.status&&(e=!0),a===_.a.StatusCode.Rejected){let t=this.chipSetReasons.selectedChipIds.map((t=>parseInt(t.replace(E.reasonChipIdPrefix,""))));t!==this._nomination.reasons&&(this._nomination.reasons=t,e=!0)}const i=this.map.lngLat;i?this._nomination.lngLat&&this._nomination.lngLat.lng===i.lng&&this._nomination.lngLat.lat===i.lat||(this._nomination.lngLat=i,e=!0):this._nomination.lngLat&&(this._nomination.lngLat=null,e=!0),e&&(this._nomination.status=a,this.events.update(this._nomination))}}E.reasonChipIdPrefix="details-reason-";e.default=E},71:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return f}));var s=a(4),i=a(6),n=a(0),o=a(19),r=a(2),c=a(14),l=a(45),d=a(7),h=a(1);const u="ui.nomination-list.card",p={location:u+".location",intelMap:u+".intelMap",bsWatermeter:u+".bsWatermeter"};class m{static build(t){const e=Object(l.a)("nomination-card",[Object(n.a)("div",{className:"info-box"},[Object(n.a)("img",{src:t.imageUrl,loading:"lazy"}),Object(n.a)("div",{},[Object(n.a)("span",{innerHTML:t.title}),Object(n.a)("div",{})])]),l.a.actions({buttons:[],icons:[]})]);return e.id="card-"+t.id,e}static update(t,e,a,i){const n=t.querySelector(".info-box > div > div");n.innerHTML="",n.append(m.buildDetail(d.a.Icon.arrowUp,e.confirmedDateString));e.restoreTime>a&&n.append(m.buildDetail(d.a.Icon.redoAlt,e.restoreIntervalString)),e.confirmedTime>0&&n.append(m.buildDetail(d.a.Icon.clock,e.intervalString));const o=e.statusData;e.status!==h.a.StatusCode.Pending&&n.append(m.buildDetail(o.icon,e.resultDateString));const u=t.querySelector(".mdc-card__action-buttons");let b;u.innerHTML="",b=e.status!==h.a.StatusCode.Rejected?o:e.reasons.length>0?e.reasonsData[0]:h.a.reason.get(h.a.Reason.undeclared);const f=l.a.buttonAction(b.icon,s.a.t(b.title));f.classList.add("status-"+o.code),u.append(f);const g=new c.a(f);g.unbounded=!0,g.listen("click",i.openDetails);const y=t.querySelector(".mdc-card__action-icons");y.innerHTML="",e.lngLat&&(y.append(m.buildIconAction(d.a.Icon.mapMarkerAlt,p.location,i.focus)),r.a.version.full&&y.append(m.buildIconAction(d.a.Icon.globe,p.intelMap,(()=>window.open(e.intelUrl,"_blank","noopener"))))),r.a.bs.beforeCreate(e)||y.append(m.buildIconAction(d.a.Icon.brain,p.bsWatermeter,i.openBs))}static buildDetail(t,e){return Object(n.a)("span",{},[Object(d.a)(t),Object(n.a)("span",{innerHTML:e})])}static buildIconAction(t,e,a){const i=l.a.iconAction(t,s.a.t(e)),n=new c.a(i);return n.unbounded=!0,n.listen("click",a),i}}const b={messageBsIdCopied:"message:ui.nomination-list.bsIdCopied"};class f extends i.a.Prototype{constructor(){super(...arguments),this.root=null,this.now=Date.now(),this.events={alert:()=>{},focus:()=>{},openDetails:()=>{}}}init(t){super.init(t),this.render()}render(){this.root=Object(n.a)("div",{className:"list-view view-hide"}),this.parent.append(this.root)}backToTop(){this.root.scrollTo(0,0)}clear(){this.root.innerHTML=""}show(t){this.clear();const e=t.map((t=>{const e=m.build(t);return m.update(e,t,this.now,this.createCardEvents(t)),e}));this.root.append(...e)}update(t,e){const a=this.root.querySelector("#card-"+t.id);m.update(a,t,this.now,this.createCardEvents(t)),a.hidden=!e}focus(t){const e=this.root.offsetTop+8,a=this.root.querySelector("#card-"+t);this.root.scrollTo(0,a.offsetTop-e)}switchView(){this.root.classList.toggle("view-hide")}createCardEvents(t){return{focus:()=>{this.events.focus(t)},openBs:()=>{r.a.version.full?window.open(t.bsUrl,"_blank","noopener"):(o.a.copy(t.id),this.events.alert(s.a.t(b.messageBsIdCopied,{id:t.id})))},openDetails:()=>this.events.openDetails(t)}}}},72:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return b})),a.d(e,"AppBarMenuItems",(function(){return m.a}));var s=a(4),i=a(68),n=a(6),o=a(0);const r="mdc-menu-surface--anchor",c="mdc-menu mdc-menu-surface",l="mdc-list",d="mdc-list-item",h="mdc-list-item__ripple",u="mdc-list-item__text";function p(t){return Object(o.a)("div",{className:r},[Object(o.a)("div",{className:c},[Object(o.a)("ul",{className:l,role:"menu",ariaHidden:!0,ariaOrientation:"vertical"},t)])])}(p||(p={})).item=function(t,e){return Object(o.a)("li",{className:d,role:"menuitem",dataset:{code:t}},[Object(o.a)("span",{className:h}),Object(o.a)("span",{className:u,innerHTML:e})])};var m=a(18);class b extends n.a.Prototype{constructor(){super(...arguments),this.ctrl=null,this.items=new Map,this.events=new Map}init(t){super.init(t),this.render()}render(){const t=p(Object.values(m.a).map((t=>{const e=p.item(t.key,s.a.t(t.title));return this.items.set(t.key,e),e})));this.parent.append(t),this.ctrl=new i.a(t.querySelector(".mdc-menu")),this.ctrl.listen("MDCMenu:selected",(t=>{this.events.get(t.detail.item.dataset.code)()}))}open(){this.ctrl.open||(this.ctrl.open=!0)}}},73:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return u}));var s=a(4),i=a(41),n=a(67),o=a(11),r=a(53),c=a(10);const l="import",d="https://wayfarer.nianticlabs.com/api/v1/vault/manage",h={title:"ui.dialog.import.title",json:"ui.dialog.import.json",from:"ui.dialog.import.from",wayfarer:"ui.dialog.import.wayfarer",import:"ui.dialog.import.import"};class u extends c.a.DialogPrototype{constructor(){super(...arguments),this.textField=null,this.import=()=>{}}render(){const t=Object(r.a)({id:"input-dialog-import-wayfarer",label:s.a.t(h.json),textarea:!0}),e=Object(o.a)("import-dialog",{title:s.a.t(h.title),contents:[t,r.a.helper([s.a.t(h.from),o.a.link(s.a.t(h.wayfarer),d)])],actions:[{action:c.a.Action.close,text:s.a.t(c.a.StringKey.close)},{action:l,text:s.a.t(h.import)}]});this.parent.append(e),this.ctrl=new i.a(e),this.textField=new n.a(t),this.ctrl.listen("MDCDialog:closed",(t=>{t.detail.action===l&&this.import(this.textField.value)}))}open(){super.open(),this.textField.value=""}}},74:function(t,e,a){"use strict";a.r(e);var s=a(4),i=a(0),n=a(41),o=a(10),r=a(11),c=a(7),l=a(1);const d="no",h="yes",u="https://wayfarer.nianticlabs.com/img/missing_image.png",p={title:"ui.dialog.match.title",desc:"ui.dialog.match.desc",no:"ui.dialog.match.no",yes:"ui.dialog.match.yes"};class m extends o.a.DialogPrototype{constructor(){super(...arguments),this.content=null,this.events={close:()=>{}}}render(){const t=Object(r.a)("match-dialog",{title:s.a.t(p.title),contents:[],actions:[{action:d,text:s.a.t(p.no)},{action:h,text:s.a.t(p.yes)}]});this.parent.append(t),this.content=t.querySelector(".mdc-dialog__content"),this.ctrl=new n.a(t),this.ctrl.listen("MDCDialog:closed",(t=>{this.events.close(t.detail.action===h)}))}set nominations(t){this.ctrl||this.render(),this.content.innerHTML="",this.content.append(s.a.t(p.desc));for(const e of t)this.buildBlock(e)}buildBlock(t){const e=[this.buildDetail(c.a.Icon.arrowUp,t.confirmedDateString)];if(t.status!==l.a.StatusCode.Pending&&(e.push(this.buildDetail(t.statusData.icon,t.resultDateString)),t.status===l.a.StatusCode.Rejected))for(const a of t.reasonsData){const t=this.buildDetail(a.icon,s.a.t(a.title));t.classList.add("status-rejected"),e.push(t)}const a=Object(i.a)("div",{className:"nomination-block"},[Object(i.a)("img",{src:t.image.length>0?t.imageUrl:u}),Object(i.a)("div",{},[Object(i.a)("span",{innerHTML:t.title}),Object(i.a)("div",{},e)])]);this.content.append(a)}buildDetail(t,e){return Object(i.a)("span",{},[Object(c.a)(t),Object(i.a)("span",{innerHTML:e})])}}e.default=m}}]);