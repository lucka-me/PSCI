!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/potori/",s(s.s=17)}([function(t,e){t.exports=mdc},function(t,e){t.exports=i18next},function(t,e){t.exports=Chart},function(t,e){t.exports=mapboxgl},function(t,e){t.exports=moment},function(t){t.exports=JSON.parse('{"version":"2","types":[{"key":"pending","code":0,"title":"Pending","icon":"","queries":[["redacted","from:ingress-support@nianticlabs.com Portal submission confirmation -edit -photo"],["prime","from:nominations@portals.ingress.com subject:(\\"能量塔提交確認\\" OR \\"Portal申請の受領確認\\" OR \\"Portal submission confirmation\\") -AP"]]},{"key":"accepted","code":1,"title":"Accepted","icon":"","queries":[["redacted","from:ingress-support@nianticlabs.com Portal review complete now available -edit -photo"],["prime","from:nominations@portals.ingress.com Intel Map AP"]]},{"key":"rejected","code":101,"title":"Rejected","icon":"","queries":[["redacted","from:ingress-support@nianticlabs.com Portal review complete reviewed -edit -photo"],["prime","from:nominations@portals.ingress.com subject:(\\"能量塔審查完畢\\" OR \\"Portal審査の完了\\" OR \\"Portal review complete\\") -AP"]]}],"reasons":[{"key":"undeclared","code":101,"title":"Undeclared","icon":"","color":"#B0373C","keywords":[["redacted",[]],["prime",[]]]},{"key":"duplicated","code":102,"title":"Duplicated","icon":"","color":"#5E90B8","keywords":[["redacted",["duplicate of either an existing Portal"]],["prime",[]]]},{"key":"tooClose","code":103,"title":"Too Close","icon":"","color":"#009345","keywords":[["redacted",["too close to an existing Portal"]],["prime",["能量塔過近"]]]}]}')},function(t,e){t.exports=i18nextBrowserLanguageDetector},function(t,e){t.exports=firebase},function(t){t.exports=JSON.parse('{"a":"0.7.0"}')},function(t){t.exports=JSON.parse('{"status":"","Pending":"Pending","Accepted":"Accepted","Rejected":"Rejected","Undeclared":"Undeclared","Duplicated":"Duplicated","Too Close":"Too Close","BrainstormingKit":"","Quality":"Quality","Description":"Description","Cultural":"Cultural","Uniqueness":"Uniqueness","Safety":"Safety","Location":"Location","AppBar":"","Open":"Open","Save":"Save","Upload":"Upload","Import":"Import","About":"About","Sign Out":"Sign Out","List":"List","Dashboard":"Dashboard","Sign In":"Sign In","Menu":"Menu","NominationCard":"","Intel Map":"Intel Map","Dialogs":"","Close":"Close","AboutDialog":"","Changelog":"Changelog","Documents":"Documents","GitHub Repo":"GitHub Repo","Blog":"Blog","DetailsDialog":"","Result Time":"Result Time","Reason":"Reason","ImportDialog":"","JSON":"JSON","From ":"From ","Wayfarer API":"Wayfarer API","Snackbar":"","Dismiss":"Dismiss","Dashboard Cards":"","Count by Month":"Count by Month","Submissions":"Submissions","Results":"Results","Filter":"Filter","Type":"Type","Quotas":"Quotas","Day":"Day","Stats Rejected":"Stats: Rejected","Stats Type":"Stats: Type","BSGroup":"","BSBasicCard":"","Brainstorming":"Brainstorming","Refresh":"Refresh","Clear":"Clear","Reviews for Portals":"Reviews for {{count}} Nominations","Brainstorming Rates":"Brainstorming Rates","Brainstorming Reviews":"Brainstorming Reviews","Reviews":"Reviews","Brainstorming Synch":"Brainstorming Synch","Reviews match the result":"Reviews match the result"}')},function(t){t.exports=JSON.parse('{"Service":"","List is empty":"List is empty.","Failed to parse as Nomination List":"Failed to parse as Nomination List.","Failed to parse as Brainstorming Data":"Failed to parse as Brainstorming Data.","Load as Brainstorming Data":"Load as Brainstorming Data.","No Nomination to save":"No Nomination to save","Uploaded":"Uploaded.","Unable to upload Nomination List":"Unable to upload Nomination List.","Unable to upload Brainstorming Data":"Unable to upload Brainstorming Data.","Unable to parse the code":"Unable to parse the code.","Invalid data":"Invalid data","Brainstorming Data updated":"Brainstorming Data updated.","FileKit":"","Failed to open file":"Failed to open file.","NominationCard":"","Brainstorming ID copied":"Brainstorming ID copied: {{id}}","DetailsDialog":"","Unable to query the location":"Unable to query the location.","Invalid DateTime":"Invalid DateTime."}')},function(t){t.exports=JSON.parse('{"status":"","Pending":"审核中","Accepted":"批准","Rejected":"拒绝","Undeclared":"未指明","Duplicated":"重复","Too Close":"过近","BrainstormingKit":"","Quality":"质量","Description":"描述","Cultural":"文化","Uniqueness":"独特","Safety":"安全","Location":"位置","AppBar":"","Open":"打开","Save":"保存","Upload":"上传","Import":"导入","About":"关于","Sign Out":"登出","List":"列表","Dashboard":"仪表盘","Sign In":"登入","Menu":"菜单","NominationCard":"","Intel Map":"情报地图","Dialogs":"","Close":"关闭","AboutDialog":"","Changelog":"更新日志","Documents":"文档","GitHub Repo":"GitHub仓库","Blog":"博客","DetailsDialog":"","Result Time":"结果时间","Reason":"原因","ImportDialog":"","JSON":"JSON","From ":"来自","Wayfarer API":"Wayfarer API","Snackbar":"","Dismiss":"关闭","Dashboard Cards":"","Count by Month":"每月统计","Submissions":"提交","Results":"结果","Filter":"筛选","Type":"类型","Quotas":"名额","Day":"天","Stats Rejected":"统计：拒绝","Stats Type":"统计：类型","BSGroup":"","BSBasicCard":"","Brainstorming":"Brainstorming","Refresh":"刷新","Clear":"清除","Reviews for Portals":"涵盖{{count}}个提名的评估","Brainstorming Rates":"Brainstorming评分","Brainstorming Reviews":"Brainstorming评估","Reviews":"评估","Brainstorming Synch":"Brainstorming同步率","Reviews match the result":"评估与结果相符"}')},function(t){t.exports=JSON.parse('{"Service":"","List is empty":"列表为空。","Failed to parse as Nomination List":"无法解析为提名列表。","Failed to parse as Brainstorming Data":"无法解析为Brainstorming数据。","Load as Brainstorming Data":"加载为Brainstorming数据。","No Nomination to save":"没有提名。","Uploaded":"已上传。","Unable to upload Nomination List":"无法上传提名列表。","Unable to upload Brainstorming Data":"无法上传Brainstorming数据。","Unable to parse the code":"无法解析代码。","Invalid data":"数据无效。","Brainstorming Data updated":"Brainstorming数据已更新。","FileKit":"FileKit","Failed to open file":"无法打开文件。","NominationCard":"","Brainstorming ID copied":"已复制Brainstorming ID：{{id}}","DetailsDialog":"","Unable to query the location":"无法查询位置。","Invalid DateTime":"时间无效。"}')},function(t){t.exports=JSON.parse('{"status":"","Pending":"審核中","Accepted":"批准","Rejected":"拒絕","Undeclared":"未指明","Duplicated":"重複","Too Close":"過近","BrainstormingKit":"","Quality":"質量","Description":"描述","Cultural":"文化","Uniqueness":"獨特","Safety":"安全","Location":"位置","AppBar":"","Open":"開啟","Save":"儲存","Upload":"上載","Import":"匯入","About":"關於","Sign Out":"登出","List":"列表","Dashboard":"儀表板","Sign In":"登入","Menu":"選單","NominationCard":"","Intel Map":"情報地圖","Dialogs":"","Close":"關閉","AboutDialog":"","Changelog":"更新日誌","Documents":"文檔","GitHub Repo":"GitHub倉庫","Blog":"部落格","DetailsDialog":"","Result Time":"結果時間","Reason":"原因","ImportDialog":"","JSON":"JSON","From ":"來自","Wayfarer API":"Wayfarer API","Snackbar":"","Dismiss":"關閉","Dashboard Cards":"","Count by Month":"每月統計","Submissions":"提交","Results":"結果","Filter":"篩選","Type":"類型","Quotas":"名額","Day":"天","Stats Rejected":"統計：拒絕","Stats Type":"統計：類型","BSGroup":"","BSBasicCard":"","Brainstorming":"Brainstorming","Refresh":"重載","Clear":"清除","Reviews for Portals":"覆蓋{{count}}個提名的評估","Brainstorming Rates":"Brainstorming評分","Brainstorming Reviews":"Brainstorming評估","Reviews":"評估","Brainstorming Synch":"Brainstorming同步率","Reviews match the result":"評估與結果相符"}')},function(t){t.exports=JSON.parse('{"Service":"","List is empty":"列表為空。","Failed to parse as Nomination List":"无法解析为提名列表。","Failed to parse as Brainstorming Data":"无法解析为Brainstorming数据。","Load as Brainstorming Data":"加載為Brainstorming數據","No Nomination to save":"没有提名。","Uploaded":"已上載。","Unable to upload Nomination List":"無法上載提名列表。","Unable to upload Brainstorming Data":"無法上載Brainstorming數據。","Unable to parse the code":"无法解析代码。","Invalid data":"數據無效。","Brainstorming Data updated":"Brainstorming數據已更新。","FileKit":"FileKit","Failed to open file":"無法打開檔案。","NominationCard":"","Brainstorming ID copied":"已拷貝Brainstorming ID：{{id}}","DetailsDialog":"","Unable to query the location":"無法查詢位置。","Invalid DateTime":"時間無效。"}')},function(t,e,s){},function(t,e,s){},function(t,e,s){"use strict";s.r(e);var i=s(1),a=s.n(i),n=s(6),o=s.n(n);var r=new class{constructor(){this.events={authStatusChanged:t=>{},onerror:t=>{}}}init(){gapi.load("client:auth2",()=>this.initClient())}initClient(){gapi.client.init({apiKey:"AIzaSyCqIaS8UizqjWrIKm5zV3_S8EffCWjKR-A",clientId:"361295761775-qshg0f5buh495dhubp4v5bignk7i5dh1.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest","https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],scope:["https://www.googleapis.com/auth/gmail.readonly","https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.appdata"].join(" ")}).then(()=>{gapi.auth2.getAuthInstance().isSignedIn.listen(this.events.authStatusChanged),this.events.authStatusChanged(this.signedIn)},this.events.onerror)}get signedIn(){return gapi.auth2.getAuthInstance().isSignedIn.get()}get accessToken(){return gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token}signIn(){gapi.auth2.getAuthInstance().signIn()}signOut(){gapi.auth2.getAuthInstance().signOut()}},l=s(7),d=s.n(l),c=s(5);class h{constructor(t,e,s,i){this.key=t,this.code=e,this.title=s,this.icon=i}}class u extends h{constructor(t,e,s,i,a){super(t,e,s,i),this.queries=a}}class p extends h{constructor(t,e,s,i,a,n){super(t,e,s,i),this.color=a,this.keywords=n}}var m=new class{constructor(){this.version=c.version,this.types=new Map,this.reasons=new Map,this.codes=new Map;for(const t of c.types){const e=new u(t.key,t.code,t.title,t.icon,new Map(t.queries));this.types.set(t.key,e),this.codes.set(t.code,e)}for(const t of c.reasons){const e=new p(t.key,t.code,t.title,t.icon,t.color,new Map(t.keywords));this.reasons.set(t.key,e),this.codes.set(t.code,e)}}typeMatched(t,e){return e<101?t===e:t>100}getTypeByCode(t){return 0===t?"pending":1===t?"accepted":"rejected"}getReasonByCode(t){if(t<100)return null;for(const e of this.reasons.values())if(e.code===t)return e;return null}},g=s(8);var b=new class{constructor(){const t=document.URL.includes("lucka.moe");this.text=`${g.a}d${c.version}-${t?"lite":"full"}`,this.fullFeature=!t}};const f={quality:"Quality",description:"Description",cultural:"Cultural",uniqueness:"Uniqueness",safety:"Safety",location:"Location"};class y{constructor(){this.reference=null,this.data=new Map}init(){const t=d.a.initializeApp({databaseURL:"https://oprbrainstorming.firebaseio.com"});this.reference=t.database().ref("c/reviews/")}query(t,e,s){this.data.has(t)?e(this.data.get(t)):b.fullFeature?this.reference.child(t).once("value",i=>{const a=i.val();a?(this.data.set(t,a),e(a)):s()},t=>s()):s()}queryLngLat(t,e,s){this.query(t,t=>{e({lng:parseFloat(t.lng),lat:parseFloat(t.lat)})},s)}update(t,e){const s=[];for(const e of t)(e.status.code<1||!this.data.has(e.id))&&s.push(e.id);let i=s.length;const a=()=>{i--,i<1&&e()};for(const t of s)this.reference.child(t).once("value",e=>{const s=e.val();s?(this.data.set(t,s),a()):a()},t=>a())}clear(){this.data.clear()}analyse(t){const e={review:0,nomination:0,rate:new Map,reviewTimes:[],synch:{total:0,synched:0}},s=Object.keys(f);for(const t of s)e.rate.set(t,[]);const i=(t,s)=>{t[s]&&e.rate.get(s).push(parseInt(t[s]))};for(const a of t){if(!this.data.has(a.id))continue;const t=this.data.get(a.id),n=[];for(const o of Object.keys(t)){if(!o.startsWith("review"))continue;const r=t[o];if(!r.stars)continue;e.review+=1,n.push(r.stars);const l=r.JSON;for(const t of s)i(l,t);e.reviewTimes.push(r.Timestamp),a.status.code<1||(e.synch.total+=1,y.isSynched(r.stars,a.status.code)&&(e.synch.synched+=1))}n.length<1||(e.nomination+=1)}return e}static getId(t){return t.replace(/[^a-zA-Z0-9]/g,"").slice(-10).toLowerCase()}static isSynched(t,e){const s=m.reasons;if("D"===t&&e===s.get("duplicated").code)return!0;const i=parseFloat(t);if(isNaN(i))return!1;const a=m.types;return i<3&&e===s.get("undeclared").code||(i>3&&e===a.get("accepted").code||i>3&&e===s.get("tooClose").code)}}var v=y;const w=Date.now();class x{constructor(){this.id="",this.title="",this.image="",this.status=m.codes.get(0),this.confirmedTime=0,this.confirmationMailId="",this.resultTime=null,this.resultMailId=null,this.lngLat=null}get imageUrl(){return"https://lh3.googleusercontent.com/"+this.image}get intelUrl(){return`https://intel.ingress.com/intel?ll=${this.lngLat.lat},${this.lngLat.lng}&z=18`}get bsUrl(){return"http://brainstorming.azurewebsites.net/watermeter.html#"+this.id}get restoreTime(){return this.confirmedTime+12096e5}get confirmedDateString(){return new Date(this.confirmedTime).toLocaleDateString()}get resultDateString(){return new Date(this.resultTime).toLocaleDateString()}get intervalString(){const t=this.resultTime?this.resultTime:w,e=Math.floor((t-this.confirmedTime)/864e5);return`${e} day${e>1?"s":""}`}get restoreIntervalString(){const t=Math.floor((this.restoreTime-w)/864e5);return`${t} day${t>1?"s":""}`}get json(){let t={id:this.id,title:this.title,image:this.image,status:this.status.code,confirmedTime:this.confirmedTime,confirmationMailId:this.confirmationMailId};return this.resultTime&&(t.resultTime=this.resultTime),this.resultMailId&&(t.resultMailId=this.resultMailId),this.lngLat&&(t.lngLat={lng:this.lngLat.lng,lat:this.lngLat.lat}),t}static from(t){const e=new x;return e.id=t.id,e.title=t.title,e.image=t.image,e.status=m.codes.get(t.status),e.confirmedTime=t.confirmedTime,e.confirmationMailId=t.confirmationMailId,t.resultTime&&(e.resultTime=t.resultTime),t.resultMailId&&(e.resultMailId=t.resultMailId),t.lngLat&&(e.lngLat={lng:t.lngLat.lng,lat:t.lngLat.lat}),e}}var T=x;class N{static mail(t,e){const s=new T;s.status=m.types.get(e.type),"pending"===e.type?(s.confirmedTime=parseInt(t.internalDate),s.confirmationMailId=t.id):(s.resultTime=parseInt(t.internalDate),s.resultMailId=t.id);for(let e=0;e<t.payload.headers.length;e++){const i=t.payload.headers[e];if("Subject"===i.name){const t=i.value,e=t.search(":"),a=t.search("：");s.title=t.slice((a<0?e:e<0||a<e?a:e)+1).trim();break}}for(const i of t.payload.parts)if("1"===i.partId){const t=this.base64(i.body.data);let a=t.slice(t.search(/googleusercontent\.com/));for(const t of['"',"\n"]){const e=a.search(t);e>0&&(a=a.slice(0,e))}s.image=a.replace("googleusercontent.com/",""),s.id=v.getId(s.image),"redacted"===e.scanner&&"pending"!==e.type&&(s.lngLat=this.lngLat(t)),"rejected"===e.type&&(s.status=this.reason(t,e.scanner));break}return s}static reason(t,e){const s=t.slice(0,t.search("-NianticOps")),i=m.reasons.get("undeclared");let a=i;for(const t of m.reasons.values()){for(const i of t.keywords.get(e))if(s.search(i)>-1){a=t;break}if(a!==i)break}return a}static lngLat(t){let e=t.slice(t.search("https://www.ingress.com/intel"));e=e.slice(0,e.search('">'));const s=e.slice(e.search("ll=")+3,e.search("&z=18")).split(",");return{lng:parseFloat(s[1]),lat:parseFloat(s[0])}}static base64(t){return unescape(decodeURIComponent(escape(window.atob(t.replace(/\-/g,"+").replace(/\_/g,"/")))))}}class L{constructor(){this.ignoreMailIdList=[],this.nominations=[],this.progress={list:0,total:0,finished:0},this.events={finished:()=>{},bufferUpdate:()=>{},progressUpdate:()=>{}}}static get scanners(){return["redacted","prime"]}static get types(){return["accepted","rejected","pending"]}start(t){this.nominations=t,this.progress.list=0,this.progress.total=0,this.progress.finished=0,this.ignoreMailIdList=[];for(const t of this.nominations)this.ignoreMailIdList.push(t.confirmationMailId),t.resultMailId&&this.ignoreMailIdList.push(t.resultMailId);for(const t of L.scanners)for(const e of L.types)this.query({scanner:t,type:e})}query(t){const e=[];this.getListRequest(null,t).execute(s=>{this.handleListRequest(s,t,e)})}getListRequest(t,e){return gapi.client.gmail.users.messages.list({userId:"me",q:m.types.get(e.type).queries.get(e.scanner),pageToken:t})}handleListRequest(t,e,s){if(t.result.messages&&s.push(...t.result.messages),t.result.nextPageToken){this.getListRequest(t.result.nextPageToken,e).execute(t=>{this.handleListRequest(t,e,s)})}else{for(let t=s.length-1;t>=0;t--)for(let e of this.ignoreMailIdList)if(s[t].id===e){s.splice(t,1);break}this.progress.list+=1,this.events.bufferUpdate(this.progress.list/6),this.processList(e,s)}}processList(t,e){this.progress.total+=e.length;const s=()=>{6===this.progress.list&&this.progress.total===this.progress.finished&&this.events.finished()};s();for(const i of e)gapi.client.gmail.users.messages.get({userId:"me",id:i.id,format:"full",metadataHeaders:"Subject"}).execute(e=>{this.nominations.push(N.mail(e.result,t)),this.progress.finished+=1,this.events.progressUpdate(this.progress.finished/this.progress.total*(this.progress.list/6)),s()})}}var k=L;class S{}S.type="application/json",S.nominations="potori.json",S.bsData="bsdata.json";class M{constructor(){this.events={openUI:()=>{},saveUI:()=>{}}}open(t,e){this.events.openUI(s=>{const i=s.target.files[0];if(!i)return void e(a.a.t("message:Failed to open file"));const n=new FileReader;n.onload=()=>{t(n.result)},n.readAsText(i)})}save(t,e){this.events.saveUI(t,URL.createObjectURL(e))}}class _{constructor(){this.ids=new Map}static get folder(){return"appDataFolder"}get(t,e){const s=i=>{if(i.length<1)return void e(null,!1);const a=i[0].id;gapi.client.drive.files.get({fileId:a,alt:"media"}).then(n=>{if(!e(n.result,!0))return gapi.client.drive.files.delete({fileId:a}),i.splice(0,1),void s(i);this.ids.set(t,a)})};gapi.client.drive.files.list({q:`name = '${t}'`,pageSize:10,spaces:_.folder,fields:"files(id)"}).then(t=>{const i=t.result.files;i?s(i):e(null,!1)})}upload(t,e,s){let i="",a="";const n={name:t,mimeType:S.type};this.ids.has(t)?(a="PATCH",i=`https://www.googleapis.com/upload/drive/v3/files/${this.ids.get(t)}?uploadType=multipart`):(a="POST",i="https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",n.parents=[_.folder]);const o=new FormData;o.append("metadata",new Blob([JSON.stringify(n)],{type:S.type})),o.append("file",e);const l="Bearer "+r.accessToken;fetch(i,{method:a,headers:new Headers({Authorization:l}),body:o}).then(t=>t.json()).then(e=>{e&&e.id&&this.ids.set(t,e.id),s(e)}).catch(()=>s(null))}}var D=class{constructor(){this.local=new M,this.googleDrive=new _}},C={"en-US":{general:s(9),message:s(10)},"zh-CN":{general:s(11),message:s(12)},"zh-TW":{general:s(13),message:s(14)}};class B{static nominations(t){const e={matched:!1,message:"",nominations:[]};try{const s=JSON.parse(t);if(0===s.length)return e.message=a.a.t("message:List is empty"),e;for(const t of s){if(!T.from(t).id)return e.nominations=[],e.message=a.a.t("message:Failed to parse as Nomination List"),e;e.nominations.push(T.from(t))}}catch(t){return e.message=a.a.t("message:Failed to parse as Nomination List"),e}return e.matched=!0,e}static bsData(t){const e={matched:!1,message:"",data:null};try{e.data=new Map(JSON.parse(t)),e.matched=!0}catch(t){e.message=a.a.t("message:Failed to parse as Brainstorming Data")}return e}}class R{static nominations(t){const e=[];for(const s of t)e.push(s.json);return new Blob([JSON.stringify(e,null,4)],{type:S.type})}static bsData(t){return new Blob([JSON.stringify([...t],null,4)],{type:S.type})}}var I=new class{constructor(){this.auth=r,this.bs=new v,this.file=new D,this.mari=new k,this.nominations=[],this.events={authStatusChanged:t=>t,progressUpdate:t=>t,updateBs:()=>{},showProgress:()=>{},show:()=>{},clear:()=>{},alert:t=>t,info:t=>t}}init(){a.a.use(o.a).init({fallbackLng:"en-US",keySeparator:!1,resources:C,ns:["general","message"],defaultNS:"general"}),this.auth.events.authStatusChanged=t=>{t||(this.nominations=[]),this.events.authStatusChanged(t),t&&this.startMail()},this.auth.events.onerror=t=>{this.events.alert(JSON.stringify(t,null,2))},this.auth.init(),this.bs.init(),this.mari.events.finished=()=>this.finish()}startMail(){this.events.clear(),this.events.showProgress(),this.download(()=>{this.mari.start(this.nominations)})}finish(){this.events.showProgress();for(let t=this.nominations.length-1;t>=0;t--){const e=this.nominations[t];for(let s=0;s<t;s++){if(e.id!==this.nominations[s].id)continue;const i=this.nominations[s];i.resultMailId?(i.confirmedTime=e.confirmedTime,i.confirmationMailId=e.confirmationMailId,i.lngLat||(i.lngLat=e.lngLat)):(i.status=e.status,i.lngLat=e.lngLat,i.resultTime=e.resultTime,i.resultMailId=e.resultMailId),this.nominations.splice(t,1);break}}this.nominations.sort((t,e)=>(t.resultTime?t.resultTime:t.confirmedTime)<(e.resultTime?e.resultTime:e.confirmedTime)?1:-1);const t=()=>{this.events.show()},e=this.nominations.reduce((t,e)=>(e.lngLat||t.push(e),t),[]);if(e.length<1)return void t();let s=0;this.events.progressUpdate(.9);const i=()=>{s+=1,this.events.progressUpdate(.9+s/e.length*.1),s===e.length&&t()};for(const t of e)this.bs.queryLngLat(t.id,e=>{t.lngLat=e,i()},i)}open(){this.events.clear();this.file.local.open(t=>{const e=B.nominations(t);if(e.matched)return this.nominations=[],this.nominations.push(...e.nominations),void this.finish();const s=B.bsData(t);return s.matched?(this.bs.data=s.data,this.nominations.length>0&&this.events.updateBs(),void this.events.info(a.a.t("message:Load as Brainstorming Data"))):void 0},this.events.alert)}save(){this.nominations.length<1?this.events.alert(a.a.t("message:No Nomination to save")):(this.file.local.save(S.nominations,R.nominations(this.nominations)),window.setTimeout(()=>{this.file.local.save(S.bsData,R.bsData(this.bs.data))},2e3))}download(t){let e=!1,s=!1;const i=()=>{e&&s&&t()};this.file.googleDrive.get(S.bsData,(t,e)=>{if(!t)return s=!0,i(),!0;try{this.bs.data=new Map(t)}catch(t){return!e&&(s=!0,i(),!0)}return s=!0,i(),!0}),this.file.googleDrive.get(S.nominations,(t,s)=>{if(!t)return e=!0,i(),!0;try{const e=t;this.nominations=e.map(t=>T.from(t))}catch(t){return!s&&(e=!0,i(),!0)}return e=!0,i(),!0})}upload(){let t=!1,e=!1;const s=()=>{t&&e&&this.events.info(a.a.t("message:Uploaded"))};this.file.googleDrive.upload(S.nominations,R.nominations(this.nominations),e=>{if(t=!0,e){if(!e.id)return void this.events.alert(`${a.a.t("message:Unable to upload Nomination List")}\n${e.message}`)}else this.events.alert(a.a.t("message:Unable to upload Nomination List"));s()}),this.file.googleDrive.upload(S.bsData,R.bsData(this.bs.data),t=>{if(e=!0,t){if(!t.id)return void this.events.alert(`${a.a.t("message:Unable to upload Brainstorming Data")}\n${t.message}`)}else this.events.alert(a.a.t("message:Unable to upload Brainstorming Data"));s()})}import(t){let e;try{e=JSON.parse(t)}catch(t){return void this.events.alert(a.a.t("message:Unable to parse the code"))}(!e.result||e.result.length<1)&&this.events.alert(a.a.t("message:Invalid data"));const s=new Map;for(const t of this.nominations)s.set(t.id,t);for(const t of e.result){const e=t.imageUrl.replace("https://lh3.googleusercontent.com/",""),i=v.getId(e);if(!s.has(i))continue;const a=s.get(i);a.title=t.title,a.lngLat={lng:parseFloat(t.lng),lat:parseFloat(t.lat)}}this.events.show()}updateBsData(){this.bs.update(this.nominations,()=>{this.events.updateBs(),this.events.info(a.a.t("message:Brainstorming Data updated"))})}clearBsData(){this.bs.clear()}},j=s(3),O=s.n(j),P=s(0);class U{static build(t,e,s){const i=document.createElement(t);for(const[t,s]of Object.entries(e))switch(t){case"cssText":i.style.cssText=s;break;case"dataset":for(const[t,e]of Object.entries(s))i.dataset[t]=e;break;default:i[t]=s}return s&&i.append(...s),i}static chartCard(t,e,s,i){return U.build("div",{className:["mdc-card","mdc-card--outlined","padding--8","flex--"+s,"flex-shrink--1"].join(" "),cssText:`min-width:${i}px`},[U.build("span",{className:"mdc-typography--headline6",innerHTML:t}),U.build("div",{className:"container-chart"},[e])])}static link(t,e,s){return U.build("a",{href:t,title:e,target:"_blank",rel:"noopener",innerHTML:s})}static icon(t){return U.build("i",{className:"far fa-fw",innerHTML:t})}static dialog(t){return U.build("div",{className:"mdc-dialog mdc-dialog--scrollable",role:"dialog",ariaModal:!0},[U.build("div",{className:"mdc-dialog__container"},[U.build("div",{className:"mdc-dialog__surface"},t)]),U.build("div",{className:"mdc-dialog__scrim"})])}static dialogAction(t,e){return U.build("button",{className:"mdc-button mdc-dialog__button",dataset:{mdcDialogAction:t}},[U.build("span",{className:"mdc-button__label",innerHTML:e})])}static notchedOutline(t){return t.className="mdc-floating-label",U.build("div",{className:"mdc-notched-outline"},[U.build("div",{className:"mdc-notched-outline__leading"}),U.build("div",{className:"mdc-notched-outline__notch"},[U.build("label",t)]),U.build("div",{className:"mdc-notched-outline__trailing"})])}}var H=U;class F{constructor(){this.parent=null,Object.defineProperty(this,"parent",{enumerable:!1})}init(t){this.parent=t}render(){}}const A={open:{key:"open",title:"Open"},save:{key:"save",title:"Save"},upload:{key:"upload",title:"Upload"},import:{key:"import",title:"Import"},about:{key:"about",title:"About"},signout:{key:"signout",title:"Sign Out"}};class V extends F{constructor(){super(...arguments),this.ctrl=null,this.items=new Map,this.events=new Map}init(t){super.init(t),this.render()}render(){const t=H.build("ul",{className:"mdc-list",role:"menu",ariaOrientation:"vertical"});for(const e of Object.values(A)){const s=H.build("li",{className:"mdc-list-item",role:"menuitem",dataset:{code:e.key},hidden:!0},[H.build("span",{className:"mdc-list-item__text",innerHTML:a.a.t(e.title)})]);this.items.set(e.key,s),t.append(s)}this.items.get(A.about.key).hidden=!1;const e=H.build("div",{className:"mdc-menu mdc-menu-surface"},[t]),s=H.build("div",{className:"mdc-menu-surface--anchor"},[e]);this.parent.append(s),this.ctrl=new P.menu.MDCMenu(e),this.ctrl.listen("MDCMenu:selected",t=>{this.events.get(t.detail.item.dataset.code)()})}open(){this.ctrl.open||(this.ctrl.open=!0)}}const q={view:{key:"view",title:"List",icon:""},signin:{key:"signin",title:"Sign In",icon:""},menu:{key:"menu",title:"Menu",icon:""}};var E=class extends F{constructor(){super(),this.menu=new V,this.actions=new Map,this.events=new Map,this.events.set(q.menu.key,()=>this.menu.open())}init(t){super.init(t),this.render()}render(){const t=H.build("section",{className:["mdc-top-app-bar__section","mdc-top-app-bar__section--align-end"].join(" ")});for(const e of Object.values(q)){const s=H.build("button",{className:"fa mdc-icon-button",title:a.a.t(e.title),innerHTML:e.icon});t.append(s);const i=new P.ripple.MDCRipple(s);i.unbounded=!0,i.listen("click",this.events.get(e.key)),s.hidden=!0,this.actions.set(e.key,s)}this.menu.init(t),this.actions.get(q.view.key).hidden=!1,this.actions.get(q.view.key).id="button-appBar-view",this.actions.get(q.menu.key).hidden=!1;const e=H.build("header",{className:"mdc-top-app-bar"},[H.build("div",{className:"mdc-top-app-bar__row"},[H.build("section",{className:["mdc-top-app-bar__section","mdc-top-app-bar__section--align-start"].join(" ")},[H.build("span",{className:"mdc-top-app-bar__title",innerHTML:"Potori"})]),t])]);this.parent.append(e),this.parent.append(H.build("div",{className:"mdc-top-app-bar--fixed-adjust"})),new P.topAppBar.MDCTopAppBar(e)}switchView(){const t=this.actions.get(q.view.key),e=""===t.innerHTML;t.innerHTML=e?"":"",t.title=a.a.t(e?"Dashboard":"List")}};var z=class extends F{constructor(){super(...arguments),this.enabled=!1,this.changed=()=>{}}init(t){super.init(t);const e=window.matchMedia("(prefers-color-scheme: dark)");e.addListener(t=>{this.enabled=t.matches,this.changed(this.enabled)}),this.enabled=e.matches}},J=s(2),$=s.n(J);class G extends F{constructor(){super(),this.root=null,Object.defineProperty(this,"root",{enumerable:!1})}update(t){}updateStyle(){}setVisible(t){if(!this.root){if(!t)return;this.render()}this.root.hidden=!t}}class Y extends G{constructor(){super(...arguments),this.chart=null}static get color(){return{border:"rgba(0, 0, 0, 0.2)",borderHover:"rgba(0, 0, 0, 0.4)"}}}class W extends G{updateStats(t){}}class K extends W{constructor(){super(...arguments),this.chart=null}}var Q=class extends W{constructor(){super(...arguments),this.textReviews=null,this.textSubtitle=null,this.actionRefresh=null,this.events={refresh:()=>{},clear:()=>{}}}render(){this.textReviews=H.build("span",{cssText:"font-weight:300;font-size:4.5rem;line-height:4.5rem;",innerHTML:"0"}),this.textSubtitle=H.build("span",{className:"mdc-typography--body1 text-nowrap",innerHTML:a.a.t("Reviews for Portals",{count:0})}),this.actionRefresh=H.build("button",{className:"mdc-button mdc-card__action mdc-card__action--button",disabled:!0},[H.build("div",{className:"mdc-button__ripple"}),H.build("i",{className:"far fa-fw mdc-button__icon",innerHTML:""}),H.build("span",{className:"mdc-button__label",innerHTML:a.a.t("Refresh")})]);const t=new P.ripple.MDCRipple(this.actionRefresh);t.unbounded=!0,t.listen("click",()=>{this.actionRefresh.disabled=!0,this.events.refresh()});const e=H.build("button",{className:["far","mdc-icon-button","mdc-card__action","mdc-card__action--icon"].join(" "),title:a.a.t("Clear"),id:"button-card-nomination-location",innerHTML:""}),s=new P.ripple.MDCRipple(e);s.unbounded=!0,s.listen("click",()=>{this.events.clear()}),this.root=H.build("div",{className:["mdc-card","mdc-card--outlined","flex--1","flex-shrink--1"].join(" ")},[H.build("div",{className:["flex-box-col","padding--8","flex-grow--1","flex-justify-content--between"].join(" ")},[H.build("span",{className:"mdc-typography--headline6",innerHTML:a.a.t("Brainstorming")}),this.textReviews,this.textSubtitle]),H.build("div",{className:"mdc-card__actions"},[H.build("div",{className:"mdc-card__action-buttons"},[this.actionRefresh]),H.build("div",{className:"mdc-card__action-icons"},[e])])]),this.setVisible(!1),this.parent.append(this.root)}updateStats(t){this.textReviews.innerHTML=""+t.review,this.textSubtitle.innerHTML=a.a.t("Reviews for Portals",{count:t.nomination}),this.actionRefresh.disabled=!1}};var Z=class extends K{render(){const t=H.build("canvas",{className:"canvas-chart--h"});this.root=H.chartCard(a.a.t("Brainstorming Rates"),t,1,240),this.setVisible(!1),this.parent.append(this.root);const e=[];for(const t of Object.values(f))e.push(a.a.t(t));const s=getComputedStyle(document.documentElement);this.chart=new $.a(t.getContext("2d"),{type:"radar",data:{labels:e,datasets:[{data:[],borderColor:s.getPropertyValue("--mdc-theme-primary"),hoverBorderColor:s.getPropertyValue("--mdc-theme-primary")}]},options:{legend:{display:!1},scale:{ticks:{display:!1,min:1,max:5,stepSize:1},angleLines:{color:s.getPropertyValue("--mdc-theme-text-disabled-on-light")},gridLines:{color:s.getPropertyValue("--mdc-theme-text-disabled-on-light")}}}})}updateStats(t){const e=[];for(const s of Object.keys(f)){const i=t.rate.get(s),a=i.reduce((t,e)=>t+e,0)/i.length;e.push(parseFloat(a.toFixed(2)))}this.chart.data.datasets[0].data=e,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].borderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.data.datasets[0].hoverBorderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.options.scale.angleLines.color=t.getPropertyValue("--mdc-theme-text-disabled-on-light"),this.chart.options.scale.gridLines.color=t.getPropertyValue("--mdc-theme-text-disabled-on-light"),this.chart.update()}};var X=class extends W{constructor(){super(...arguments),this.textSynch=null}render(){this.textSynch=H.build("span",{cssText:"font-weight:300;font-size:6rem;line-height:6rem;",innerHTML:"0.0"}),this.root=H.build("div",{className:["mdc-card","mdc-card--outlined","padding--8","flex--1","flex-shrink--1","flex-justify-content--between"].join(" ")},[H.build("span",{className:"mdc-typography--headline6",innerHTML:a.a.t("Brainstorming Synch")}),H.build("span",{className:"text-nowarp"},[this.textSynch,H.build("span",{cssText:"font-size:2rem;line-height:2rem;",innerHTML:"%"})]),H.build("span",{className:"mdc-typography--body1 text-nowarp",innerHTML:a.a.t("Reviews match the result")})]),this.setVisible(!1),this.parent.append(this.root)}updateStats(t){const e=t.synch.total>0?t.synch.synched/t.synch.total:0;this.textSynch.innerHTML=""+(100*e).toFixed(1)}},tt=s(4),et=s.n(tt);var st=class{static fillTimeDataMap(t,e,s){let i=e;for(;i<=s;){const e=et()(i+1e3).startOf("month"),s=e.valueOf();t.has(s)||t.set(s,0),i=e.endOf("month").valueOf()}}};var it=class extends K{render(){const t=H.build("canvas",{className:"canvas-chart--h"});this.root=H.chartCard(a.a.t("Brainstorming Reviews"),t,3,300),this.setVisible(!1),this.parent.append(this.root);const e=getComputedStyle(document.documentElement);this.chart=new $.a(t.getContext("2d"),{type:"line",data:{labels:[],datasets:[{label:a.a.t("Reviews"),data:[],borderColor:e.getPropertyValue("--mdc-theme-primary"),pointHoverBorderColor:e.getPropertyValue("--mdc-theme-primary")}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{type:"time",time:{unit:"month",tooltipFormat:"YYYY-MM",displayFormats:{month:"YYYY-MM"}}}]}}})}updateStats(t){if(t.reviewTimes.length<1)return this.chart.data.datasets[0].data=[],void this.chart.update();const e=new Map;let s=et()(t.reviewTimes[0]).startOf("month").valueOf(),i=s;for(const a of t.reviewTimes){const t=et()(a).startOf("month").valueOf();t<s?s=t:t>i&&(i=t),e.has(t)?e.set(t,e.get(t)+1):e.set(t,1)}st.fillTimeDataMap(e,s,i);const a=[];e.forEach((t,e)=>{a.push({t:e,y:t})}),a.sort((t,e)=>t.t-e.t),this.chart.data.datasets[0].data=a,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].borderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.data.datasets[0].hoverBorderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.update()}};var at=class extends G{constructor(){super(),this.basic=new Q,this.rates=new Z,this.synch=new X,this.reviews=new it,this.events={analyse:()=>({review:0,nomination:0,rate:new Map,reviewTimes:[],synch:{total:0,synched:0}})},Object.defineProperty(this,"events",{enumerable:!1})}init(t){this.forEach(e=>{e.init(t)})}update(t){const e=this.events.analyse(t);this.forEach(t=>{t.updateStats(e)})}updateStyle(){this.forEach(t=>{t.updateStyle()})}setVisible(t){this.forEach(e=>{e.setVisible(t)})}forEach(t){Object.values(this).forEach(t)}};var nt=class extends Y{render(){const t=H.build("canvas",{className:"canvas-chart--h"});this.root=H.chartCard(a.a.t("Count by Month"),t,3,300),this.setVisible(!1),this.parent.append(this.root);const e=getComputedStyle(document.documentElement);this.chart=new $.a(t.getContext("2d"),{type:"line",data:{labels:[],datasets:[{label:a.a.t("Submissions"),data:[],borderColor:e.getPropertyValue("--mdc-theme-primary"),pointHoverBorderColor:e.getPropertyValue("--mdc-theme-primary"),fill:!1},{label:a.a.t("Results"),data:[],borderColor:e.getPropertyValue("--mdc-theme-secondary"),pointHoverBorderColor:e.getPropertyValue("--mdc-theme-secondary"),fill:!1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{type:"time",time:{unit:"month",tooltipFormat:"YYYY-MM",displayFormats:{month:"YYYY-MM"}}}]},tooltips:{mode:"x"}}})}update(t){if(0===t.length)return this.chart.data.datasets[0].data=[],this.chart.data.datasets[1].data=[],void this.chart.update();const e=new Map,s=new Map;let i=et()(t[0].confirmedTime).startOf("month").valueOf(),a=i;for(const n of t){const t=et()(n.confirmedTime).startOf("month").valueOf();if(t<i?i=t:t>a&&(a=t),e.has(t)?e.set(t,e.get(t)+1):e.set(t,1),!n.resultTime)continue;const o=et()(n.resultTime).startOf("month").valueOf();o>a&&(a=o),s.has(o)?s.set(o,s.get(o)+1):s.set(o,1)}st.fillTimeDataMap(e,i,a),st.fillTimeDataMap(s,i,a);const n=[],o=[];e.forEach((t,e)=>{n.push({t:e,y:t})}),s.forEach((t,e)=>{o.push({t:e,y:t})}),n.sort((t,e)=>t.t-e.t),o.sort((t,e)=>t.t-e.t),this.chart.data.datasets[0].data=n,this.chart.data.datasets[1].data=o,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].borderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.data.datasets[0].hoverBorderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.data.datasets[1].borderColor=t.getPropertyValue("--mdc-theme-secondary"),this.chart.data.datasets[1].hoverBorderColor=t.getPropertyValue("--mdc-theme-secondary"),this.chart.update()}};class ot extends G{constructor(){super(...arguments),this.block={type:{root:null},reason:{root:null}},this.types=new Map,this.reasons=new Map,this.events={switchType:()=>{},switchReason:()=>{}}}render(){this.block.type.root=H.build("div",{className:"flex-box-row--nowrap"}),this.block.reason.root=H.build("div",{className:"flex-box-row--nowrap"}),this.root=H.build("div",{className:["mdc-card","mdc-card--outlined","padding--8","flex--1","flex-shrink--0"].join(" ")},[H.build("span",{className:"mdc-typography--headline6",innerHTML:a.a.t("Filter")}),H.build("span",{className:"mdc-typography--subtitle1",innerHTML:a.a.t("Type")}),this.block.type.root,H.build("span",{className:"mdc-typography--subtitle1",innerHTML:a.a.t("Rejected")}),this.block.reason.root]),this.setVisible(!1),this.parent.append(this.root);for(const t of m.reasons.values()){const e=ot.buildSwitch(this.block.reason,t,"rejected");e.listen("change",()=>{this.switchReason(t,e.checked)}),this.reasons.set(t,e)}for(const t of m.types.values()){const e=ot.buildSwitch(this.block.type,t,t.key);e.listen("change",()=>this.switchType(t,e.checked)),this.types.set(t,e)}}switchType(t,e){if(t.code>100)for(const t of this.reasons.values())t.checked=e;this.events.switchType(t,e)}switchReason(t,e){this.events.switchReason(t,e);const s=m.types.get("rejected");e&&!this.types.get(s).checked&&(this.types.get(s).checked=!0,this.events.switchType(s,!0))}static buildSwitch(t,e,s){const i="switch-filter-"+e.key,n=H.build("div",{className:"mdc-switch"},[H.build("div",{className:"mdc-switch__track"}),H.build("div",{className:"mdc-switch__thumb-underlay",id:i},[H.build("div",{className:"mdc-switch__thumb"},[H.build("input",{type:"checkbox",className:"mdc-switch__native-control",role:"switch"})])])]),o=H.build("div",{className:"mdc-switch-box margin-h--4"},[n,H.build("label",{className:"far fa-fw status-"+s,for:i,title:a.a.t(e.title),innerHTML:e.icon})]);t.root.append(o);const r=new P.switchControl.MDCSwitch(n);return r.checked=!0,r}}var rt=new ot;class lt extends G{constructor(){super(...arguments),this.ctrl=null,this.events={focus:()=>{},styleLoaded:()=>[]},this.tasks=[]}render(){const t=H.build("div",{cssText:["width: 100%","height: 100%","clip-path: inset(100% round 4px)","-webkit-clip-path: inset(0 round 4px)"].join(";")});this.root=H.build("div",{className:"mdc-card mdc-card--outlined flex--3 flex-shrink--1",cssText:"min-width: 300px;"},[t]),this.parent.append(this.root),this.ctrl=new O.a.Map({container:t,style:`mapbox:${getComputedStyle(document.documentElement).getPropertyValue("--map-style").trim()}?optimize=true`}),this.ctrl.on("idle",()=>this.executeTasks()),this.ctrl.addControl(new O.a.NavigationControl),this.ctrl.addControl(new O.a.FullscreenControl),this.resize()}get loaded(){return this.ctrl&&this.ctrl.isStyleLoaded()}update(t){this.loaded?(this.updateRejected(t),this.updateSource("accepted",lt.generateGeoJSON(t,[m.types.get("accepted").code])),this.updateSource("pending",lt.generateGeoJSON(t,[m.types.get("pending").code]))):this.tasks.push(()=>this.update(t))}updateStyle(){this.loaded?(this.ctrl.setStyle(`mapbox:${getComputedStyle(document.documentElement).getPropertyValue("--map-style").trim()}?optimize=true`),this.update(this.events.styleLoaded())):this.tasks.push(()=>this.updateStyle())}setTypeVisible(t,e){if(!this.loaded)return void this.tasks.push(()=>this.setTypeVisible(t,e));const s=e?"visible":"none";this.ctrl.setLayoutProperty(`potori-${t}-cluster`,"visibility",s),this.ctrl.setLayoutProperty(`potori-${t}-count`,"visibility",s),this.ctrl.setLayoutProperty(`potori-${t}-unclustered`,"visibility",s)}easeTo(t){if(!this.loaded)return void this.tasks.push(()=>this.easeTo(t));const e=this.ctrl.getZoom();this.ctrl.easeTo({center:t,zoom:e<15?15:e})}resize(){this.loaded?this.ctrl.resize():this.tasks.push(()=>this.resize())}fit(t){if(!this.loaded)return void this.tasks.push(()=>this.fit(t));const e={lng:-181,lat:-91},s={lng:181,lat:91};for(const i of t)i.lngLat&&(i.lngLat.lng>e.lng&&(e.lng=i.lngLat.lng),i.lngLat.lng<s.lng&&(s.lng=i.lngLat.lng),i.lngLat.lat>e.lat&&(e.lat=i.lngLat.lat),i.lngLat.lat<s.lat&&(s.lat=i.lngLat.lat));s.lng>-181&&this.ctrl.fitBounds([s,e],{linear:!0})}updateRejected(t){if(!this.loaded)return void this.tasks.push(()=>this.updateRejected(t));const e=[];for(const[t,s]of rt.reasons.entries())s.checked&&e.push(t.code);this.updateSource("rejected",lt.generateGeoJSON(t,e))}executeTasks(){const t=this.tasks.length;for(let e=0;e<t;e++)this.tasks.shift()()}updateSource(t,e){const s="potori-"+t,i=this.ctrl.getSource(s);if(i)return void i.setData(e);this.ctrl.addSource(s,{type:"geojson",data:e,cluster:!0});const a=getComputedStyle(document.documentElement),n=a.getPropertyValue("--color-"+t),o=a.getPropertyValue(`--color-${t}--dark`);this.ctrl.addLayer({id:s+"-cluster",type:"circle",source:s,filter:["has","point_count"],paint:{"circle-color":n,"circle-opacity":.6,"circle-stroke-width":4,"circle-stroke-color":o,"circle-radius":["step",["get","point_count"],20,50,30,100,40]}}),this.ctrl.addLayer({id:s+"-count",type:"symbol",source:s,filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":getComputedStyle(document.documentElement).getPropertyValue("--mdc-theme-on-surface")}}),this.ctrl.addLayer({id:s+"-unclustered",type:"circle",source:s,filter:["!",["has","point_count"]],paint:{"circle-color":n,"circle-radius":5,"circle-stroke-width":2,"circle-stroke-color":o}}),this.ctrl.on("click",s+"-cluster",t=>{const e=this.ctrl.queryRenderedFeatures(t.point,{layers:[s+"-cluster"]}),i=e[0].properties.cluster_id;this.ctrl.getSource(s).getClusterExpansionZoom(i,(t,s)=>{t||this.ctrl.easeTo({center:e[0].geometry.coordinates,zoom:s})})}),this.ctrl.on("click",s+"-unclustered",t=>{t.features[0].geometry.coordinates;const e=t.features[0].geometry.coordinates;for(;Math.abs(t.lngLat.lng-e[0])>180;)e[0]+=t.lngLat.lng>e[0]?360:-360;(new O.a.Popup).setLngLat(e).setText(t.features[0].properties.title).addTo(this.ctrl),this.events.focus(t.features[0].properties.id)})}static generateGeoJSON(t,e){const s={type:"FeatureCollection",features:[]};if(e.length<1)return s;for(const i of t)e.includes(i.status.code)&&i.lngLat&&s.features.push({type:"Feature",properties:{id:i.id,title:i.title,status:i.status},geometry:{type:"Point",coordinates:[i.lngLat.lng,i.lngLat.lat]}});return s}}var dt=lt;var ct=class extends Y{render(){const t=H.build("canvas",{className:"canvas-chart--h"});this.root=H.chartCard(a.a.t("Quotas"),t,2,200),this.setVisible(!1),this.parent.append(this.root);const e=[];for(let t=0;t<14;t++)e.push(""+t);const s=getComputedStyle(document.documentElement);this.chart=new $.a(t.getContext("2d"),{type:"line",data:{labels:e,datasets:[{data:[],borderColor:s.getPropertyValue("--mdc-theme-primary"),pointHoverBorderColor:s.getPropertyValue("--mdc-theme-primary")}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{scaleLabel:{display:!0,labelString:a.a.t("Day")}}]}}})}update(t){const e=new Array(14).fill(0),s=Date.now();for(const i of t){const t=i.restoreTime;t>s&&(e[Math.floor((t-s)/864e5)]+=1)}this.chart.data.datasets[0].data=e,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].borderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.data.datasets[0].hoverBorderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.update()}};class ht extends Y{render(){const t=H.build("canvas",{className:"canvas-chart--v"});this.root=H.chartCard(a.a.t("Stats Rejected"),t,2,250),this.setVisible(!1),this.parent.append(this.root);const e=[],s=[];for(const t of m.reasons.values())e.push(a.a.t(t.title)),s.push(t.color);this.chart=new $.a(t.getContext("2d"),{type:"doughnut",data:{labels:e,datasets:[{data:[],backgroundColor:s,borderAlign:"inner",borderColor:ht.color.border,hoverBackgroundColor:s,hoverBorderColor:ht.color.borderHover}]},options:{legend:{display:!0,position:"right"}}})}update(t){const e=new Array(m.reasons.size).fill(0);for(const s of t)s.status.code>100&&(e[s.status.code-101]+=1);this.chart.data.datasets[0].data=e,this.chart.update()}}var ut=ht;class pt extends Y{render(){const t=H.build("canvas",{className:"canvas-chart--v"});this.root=H.chartCard(a.a.t("Stats Type"),t,2,250),this.setVisible(!1),this.parent.append(this.root);const e=[],s=[],i=[],n=[],o=getComputedStyle(document.documentElement);for(const[t,r]of m.types.entries())e.push(a.a.t(r.title)),s.push(o.getPropertyValue("--color-"+t)),i.push(o.getPropertyValue(`--color-${t}--light`)),n.push(o.getPropertyValue(`--color-${t}--dark`));this.chart=new $.a(t.getContext("2d"),{type:"doughnut",data:{labels:e,datasets:[{data:[],backgroundColor:s,borderAlign:"inner",borderColor:pt.color.border,hoverBackgroundColor:s,hoverBorderColor:pt.color.borderHover}]},options:{legend:{display:!0,position:"right"}}})}update(t){const e=new Array(3).fill(0);for(const s of t)s.status.code>100?e[2]+=1:e[s.status.code]+=1;this.chart.data.datasets[0].data=e,this.chart.update()}}var mt=pt;var gt=class extends F{constructor(){super(),this.root=null,this.map=new dt,this.filter=rt,this.statsType=new mt,this.statsRejected=new ut,this.countByMonth=new nt,this.quotas=new ct,this.bs=new at,Object.defineProperty(this,"root",{enumerable:!1})}init(t){super.init(t),$.a.defaults.global.legend.labels.boxWidth=10,$.a.defaults.global.maintainAspectRatio=!1,$.a.defaults.line.tooltips={intersect:!1},$.a.defaults.doughnut.tooltips={callbacks:{label:(t,e)=>{const s=e.datasets[t.datasetIndex],i=s._meta,a=i[Object.keys(i)[0]].data,n=s.data.reduce((t,e,s)=>t+(a[s].hidden?0:e),0),o=s.data[t.index],r=(o/n*100).toFixed(2);return`${e.labels[t.index]}: ${o} (${r}%)`}}},$.a.defaults.radar.tooltips={intersect:!1,callbacks:{title:(t,e)=>e.labels[t[0].index]}},this.render(),this.forEach(t=>{t.init(this.root)})}render(){this.root=H.build("div",{className:["flex--2","flex-box-row--wrap","flex-align-items--start","flex-align-content--start","padding--4","dashboard"].join(" "),cssText:["height: 100%","box-sizing: border-box","overflow-y: scroll","scroll-behavior: smooth","-webkit-overflow-scrolling: touch"].join(";")}),this.parent.append(this.root)}refresh(t){this.forEach(e=>{e.update(t)})}update(t){this.map.update(t),this.statsType.update(t),this.statsRejected.update(t),this.countByMonth.update(t)}updateStyle(){this.forEach(t=>{t.updateStyle()})}setVisible(t){this.forEach(e=>{e.setVisible(t)}),this.map.resize()}forEach(t){Object.values(this).forEach(t)}};class bt extends F{constructor(){super(...arguments),this.ctrl=null}}var ft=class extends bt{render(){const t=H.dialog([H.build("h2",{className:"mdc-dialog__title",innerHTML:a.a.t("About")}),H.build("div",{className:"mdc-dialog__content flex-box-col"},[H.build("span",{className:"mdc-typography--body2"},[H.link("./docs",a.a.t("Documents"),a.a.t("Documents"))]),H.build("span",{className:"mdc-typography--body2"},[H.link("https://github.com/lucka-me/potori",a.a.t("GitHub Repo"),a.a.t("GitHub Repo"))]),H.build("span",{className:"mdc-typography--body2"},[H.link("https://github.com/lucka-me/potori/blob/master/CHANGELOG.md",a.a.t("Changelog"),b.text)," by ",H.link("https://lucka.moe",a.a.t("Blog"),"Lucka")])]),H.build("footer",{className:"mdc-dialog__actions"},[H.dialogAction("close",a.a.t("Close"))])]);this.parent.append(t),this.ctrl=new P.dialog.MDCDialog(t)}open(){this.ctrl||this.render(),this.ctrl.open()}};var yt=new class extends bt{constructor(){super(...arguments),this.textMessage=null}render(){this.textMessage=H.build("div",{className:"mdc-dialog__content"});const t=H.dialog([this.textMessage,H.build("footer",{className:"mdc-dialog__actions"},[H.dialogAction("close",a.a.t("Close"))])]);this.parent.append(t),this.ctrl=new P.dialog.MDCDialog(t)}open(t){this.parent||this.render(),this.ctrl.open(),this.textMessage.innerHTML=t}};class vt extends F{constructor(){super(...arguments),this.ctrl=null,this.marker=null,this.dialog=null,this.nomination=null,this.buttons={edit:{root:null,icon:"",clicked:()=>this.edit()},search:{root:null,icon:"",clicked:()=>this.search()},delete:{root:null,icon:"",clicked:()=>this.delete()}},this.events={queryLngLat:()=>{}}}init(t){super.init(t),this.render()}render(){const t=[];for(const e of Object.values(this.buttons)){e.root=H.build("button",{className:"far mdc-icon-button",innerHTML:e.icon});const s=new P.ripple.MDCRipple(e.root);s.unbounded=!0,s.listen("click",e.clicked),t.push(e.root)}const e=H.build("div",{className:"flex-grow--1",cssText:"min-height: 180px"}),s=H.build("div",{className:"flex-box-row--nowrap margin-v--8"},[H.build("div",{className:"flex-box-col flex-justify-content--around"},t),e]);this.parent.append(s),this.ctrl=new O.a.Map({container:e,style:`mapbox:${getComputedStyle(document.documentElement).getPropertyValue("--map-style").trim()}?optimize=true`}),this.ctrl.addControl(new O.a.NavigationControl)}set(t){this.nomination=t,this.delete(),this.nomination.lngLat&&(this.marker=new O.a.Marker,this.marker.setLngLat(this.nomination.lngLat).addTo(this.ctrl),this.ctrl.jumpTo({center:this.nomination.lngLat,zoom:16}),this.buttons.delete.root.disabled=!1,this.buttons.edit.root.innerHTML=""),this.buttons.search.root.disabled=!1}edit(){this.marker?this.marker.setDraggable(!0):(this.marker=(new O.a.Marker).setLngLat(this.ctrl.getCenter()).setDraggable(!0).addTo(this.ctrl),this.buttons.delete.root.disabled=!1,this.buttons.edit.root.innerHTML="")}search(){this.buttons.search.root.disabled=!0,this.events.queryLngLat(this.nomination.id,t=>{this.dialog.isOpen&&(this.marker?this.marker.setLngLat(t):this.marker=(new O.a.Marker).setLngLat(t).addTo(this.ctrl),this.marker.setDraggable(!1),this.ctrl.easeTo({center:t,zoom:16}),this.buttons.edit.root.innerHTML="",this.buttons.search.root.disabled=!1,this.buttons.delete.root.disabled=!1)},()=>{this.dialog.isOpen&&(yt.open(a.a.t("message:Unable to query the location")),this.buttons.search.root.disabled=!1)})}delete(){this.marker&&this.marker.remove(),this.marker=null,this.buttons.edit.root.innerHTML="",this.buttons.delete.root.disabled=!0}}var wt=class extends bt{constructor(){super(...arguments),this.nomination=null,this.headingTitle=null,this.image=null,this.textConfirmedTime=null,this.status=new Map,this.selectedStatus=null,this.fieldResultTime=null,this.selectReason=null,this.elementReason=null,this.map=new vt,this.events={update:()=>{},query:()=>{}}}render(){this.headingTitle=H.build("h2",{className:"mdc-dialog__title",dataset:{mdcDialogInitialFocus:""},innerHTML:""}),this.image=H.build("img",{cssText:["object-fit:cover","object-position:center","width:100%","height:150px;"].join(";")}),this.textConfirmedTime=H.build("span",{className:"margin-l--4"});const t=[];for(const e of m.types.keys()){const s="radio-dialog-details-status-"+e,i=H.build("input",{type:"radio",className:"mdc-radio__native-control",name:"radio-dialog-details-status",value:e});i.addEventListener("change",t=>{const e=t.target;this.selectedStatus=e.value,this.fieldResultTime.root_.hidden="pending"===e.value,this.fieldResultTime.layout(),this.elementReason.hidden=!("rejected"===e.value),this.selectReason.layout(),this.map.ctrl.resize()});const a=H.build("div",{className:"mdc-radio"},[i,H.build("div",{className:"mdc-radio__background"},[H.build("div",{className:"mdc-radio__outer-circle"}),H.build("div",{className:"mdc-radio__inner-circle"})])]),n=H.build("div",{className:"mdc-form-field"},[a,H.build("label",{for:s,className:"far status-"+e,innerHTML:m.types.get(e).icon})]),o=new P.radio.MDCRadio(a);this.status.set(e,o);new P.formField.MDCFormField(n).input=o,t.push(n)}const e=H.build("div",{className:["mdc-text-field","mdc-text-field--outlined","mdc-text-field--with-leading-icon","margin-v--8","margin-h--4","flex-grow--1"].join(" ")},[H.build("i",{className:["fa","mdc-text-field__icon","mdc-text-field__icon--leading"].join(" "),innerHTML:""}),H.build("input",{type:"datetime-local",className:"mdc-text-field__input",id:"input-dialog-details-result-time"}),H.notchedOutline({for:"input-dialog-details-result-time",innerHTML:a.a.t("Result Time")})]);this.fieldResultTime=new P.textField.MDCTextField(e);const s=[];for(const[t,e]of m.reasons.entries())s.push(H.build("li",{className:"mdc-list-item",dataset:{value:t},innerHTML:a.a.t(e.title)}));this.elementReason=H.build("div",{className:["mdc-select","mdc-select--outlined","margin-v--8","margin-h--4"].join(" ")},[H.build("div",{className:"mdc-select__anchor"},[H.build("i",{className:"mdc-select__dropdown-icon"}),H.build("div",{className:"mdc-select__selected-text"}),H.notchedOutline({innerHTML:a.a.t("Reason")})]),H.build("div",{className:"mdc-select__menu mdc-menu mdc-menu-surface"},[H.build("ul",{className:"mdc-list"},s)])]),this.selectReason=new P.select.MDCSelect(this.elementReason),this.selectReason.selectedIndex=0;const i=H.build("div",{className:"mdc-dialog__content"},[H.build("div",{className:["mdc-typography--body1","flex-box-row--nowrap","flex-align-items--center"].join(" ")},[H.icon("&#xf062"),this.textConfirmedTime]),H.build("div",{className:["fullwidth","flex-box-row--nowrap","flex-justify-content--around"].join(" ")},t),H.build("div",{className:"flex-box-row--wrap"},[e,this.elementReason])]);this.map.init(i);const n=H.dialog([this.headingTitle,this.image,i,H.build("footer",{className:"mdc-dialog__actions"},[H.dialogAction("close","Close"),H.dialogAction("save","Save")])]);this.parent.append(n),this.ctrl=new P.dialog.MDCDialog(n),this.ctrl.listen("MDCDialog:opened",()=>this.opened()),this.ctrl.listen("MDCDialog:closed",t=>this.closed(t)),this.map.dialog=this.ctrl}opened(){this.fieldResultTime.layout(),this.selectReason.layout(),this.map.ctrl.resize()}closed(t){if("save"!==t.detail.action)return;const e=m.getTypeByCode(this.nomination.status.code),s=m.getReasonByCode(this.nomination.status.code),i=this.selectedStatus;let n=!1;if("pending"!==i){const t=Date.parse(this.fieldResultTime.value);if(!t)return void yt.open(a.a.t("message:Invalid DateTime"));const e=t+6e4*(new Date).getTimezoneOffset();this.nomination.resultTime&&Math.floor(this.nomination.resultTime/6e4)===Math.floor(e/6e4)||(this.nomination.resultTime=e,n=!0)}const o=this.selectReason.value;if((i!==e||"rejected"===e&&s.key!==o)&&(n=!0),this.map.marker){const t=this.map.marker.getLngLat();this.nomination.lngLat&&this.nomination.lngLat.lng===t.lng&&this.nomination.lngLat.lat===t.lat||(this.nomination.lngLat=t,n=!0)}else this.nomination.lngLat&&(this.nomination.lngLat=null,n=!0);n&&("rejected"!==this.selectedStatus?this.nomination.status=m.types.get(this.selectedStatus):this.nomination.status=m.reasons.get(this.selectReason.value),this.events.update(this.nomination))}open(t){this.ctrl||this.render(),this.nomination=t,this.map.set(t);const e=m.getTypeByCode(t.status.code);this.headingTitle.innerHTML=t.title,this.image.src=t.imageUrl,this.textConfirmedTime.innerHTML=new Date(t.confirmedTime).toLocaleString(),this.fieldResultTime.root_.hidden="pending"===e;const s=t=>{const e=new Date;return e.setTime(t-6e4*e.getTimezoneOffset()),e.toISOString()},i=s(t.resultTime?t.resultTime:Date.now());this.fieldResultTime.value=i.slice(0,i.lastIndexOf(":")),this.elementReason.hidden=!("rejected"===e),"rejected"===e&&(this.selectReason.selectedIndex=t.status.code-m.types.get(e).code),"pending"===e&&this.events.query(t.id,t=>{const e=s(t.lastTime);this.fieldResultTime.value=e.slice(0,e.lastIndexOf(":")),this.fieldResultTime.layout()},()=>{}),this.status.get(e).checked=!0,this.selectedStatus=e,this.ctrl.open()}updateStyle(){this.map.ctrl&&this.map.ctrl.setStyle(`mapbox:${getComputedStyle(document.documentElement).getPropertyValue("--map-style").trim()}?optimize=true`)}};var xt=class extends bt{constructor(){super(...arguments),this.textField=null,this.events={import:()=>{}}}render(){const t=H.build("div",{className:["mdc-text-field","mdc-text-field--outlined","mdc-text-field--textarea","mdc-text-field--fullwidth"].join(" ")},[H.build("textarea",{className:"mdc-text-field__input code",id:"input-dialog-import-wayfarer",rows:8,cols:80}),H.build("div",{className:"mdc-notched-outline"},[H.build("div",{className:"mdc-notched-outline__leading"}),H.build("div",{className:"mdc-notched-outline__notch"},[H.build("label",{className:"mdc-floating-label",for:"input-dialog-import-wayfarer",innerHTML:"JSON"})]),H.build("div",{className:"mdc-notched-outline__trailing"})])]),e=H.dialog([H.build("h2",{className:"mdc-dialog__title",innerHTML:a.a.t("Import")}),H.build("div",{className:"mdc-dialog__content"},[t,H.build("div",{className:"mdc-text-field-helper-line"},[H.build("div",{className:"mdc-text-field-helper-text mdc-text-field-helper-text--persistent"},[a.a.t("From "),H.link("https://wayfarer.nianticlabs.com/api/v1/vault/manage",a.a.t("Wayfarer API"),a.a.t("Wayfarer API"))])])]),H.build("footer",{className:"mdc-dialog__actions"},[H.dialogAction("close",a.a.t("Close")),H.dialogAction("import",a.a.t("Import"))])]);this.parent.append(e),this.ctrl=new P.dialog.MDCDialog(e),this.textField=new P.textField.MDCTextField(t),this.ctrl.listen("MDCDialog:closed",t=>{this.closed(t)})}open(){this.ctrl||this.render(),this.ctrl.open()}closed(t){"import"===t.detail.action&&this.events.import(this.textField.value)}};var Tt=new class extends F{constructor(){super(...arguments),this.ctrl=null,this.textMessage=null}render(){this.textMessage=H.build("div",{className:"mdc-snackbar__label",role:"status",ariaLive:"polite"});const t=H.build("div",{className:"mdc-snackbar__actions"},[H.build("button",{className:"far mdc-icon-button mdc-snackbar__dismiss",title:a.a.t("Dismiss"),innerHTML:"&#xf00d"})]),e=H.build("div",{className:"mdc-snackbar"},[H.build("div",{className:"mdc-snackbar__surface"},[this.textMessage,t])]);this.parent.append(e),this.ctrl=new P.snackbar.MDCSnackbar(e)}open(t){this.ctrl||this.render(),this.textMessage.innerHTML=t,this.ctrl.open()}};var Nt=class extends F{constructor(){super(...arguments),this.about=new ft,this.alert=yt,this.details=new wt,this.import=new xt,this.shackbar=Tt}init(t){super.init(t);for(const e of Object.values(this))e.init(t)}};var Lt=class{static build(t,e,s){const i=["margin-r--8","flex-box-row--nowrap","flex-align-items--center"].join(" "),n=[];n.push(H.build("span",{className:i},[H.icon("&#xf062"),H.build("span",{className:"margin-l--4",innerHTML:t.confirmedDateString})]));t.restoreTime>e&&n.push(H.build("span",{className:i},[H.icon("&#xf2f9"),H.build("span",{className:"margin-l--4",innerHTML:t.restoreIntervalString})])),n.push(H.build("span",{className:i},[H.icon("&#xf017"),H.build("span",{className:"margin-l--4",id:"text-card-nomination-interval"})])),n.push(H.build("span",{className:i,id:"box-card-nomination-result"},[H.icon("&#xf00c"),H.build("span",{className:"margin-l--4"})]));const o=["object-fit: cover","object-position: center","width: 120px","min-width: 120px","height: 120px","min-height: 120px"].join(";"),r=H.build("div",{className:"mdc-card__primary-action"},[H.build("div",{className:"flex-box-row--nowrap"},[H.build("img",{cssText:o,src:t.imageUrl}),H.build("div",{className:["padding--8","flex-box--col","flex-align-items--start","flex-justify-content--start"].join(" ")},[H.build("span",{className:"mdc-typography--headline6",innerHTML:t.title}),H.build("div",{className:"mdc-typography--body2 flex-box-row--wrap"},n)])])]);new P.ripple.MDCRipple(r).listen("click",s.openDetails);const l=H.build("button",{className:"mdc-button mdc-card__action mdc-card__action--button"},[H.build("div",{className:"mdc-button__ripple"}),H.build("i",{className:"far fa-fw mdc-button__icon"}),H.build("span",{className:"mdc-button__label"})]),d=new P.ripple.MDCRipple(l);d.unbounded=!0,b.fullFeature?d.listen("click",()=>{window.open(t.bsUrl,"_blank","noopener")}):d.listen("click",()=>{const e=H.build("textarea",{value:t.id,readOnly:!0});document.body.append(e),e.select(),document.execCommand("copy"),e.remove(),yt.open(a.a.t("message:Brainstorming ID copied:",{id:t.id}))});const c=[],h=["far","mdc-icon-button","mdc-card__action","mdc-card__action--icon"].join(" "),u=H.build("button",{className:h,title:a.a.t("Location"),id:"button-card-nomination-location",hidden:!0,innerHTML:"&#xf3c5"}),p=new P.ripple.MDCRipple(u);if(p.unbounded=!0,p.listen("click",s.focus),c.push(u),b.fullFeature){const e=H.build("button",{className:h,title:a.a.t("Intel Map"),id:"button-card-nomination-intel",hidden:!0,innerHTML:"&#xf279"}),s=new P.ripple.MDCRipple(e);s.unbounded=!0,s.listen("click",()=>{window.open(t.intelUrl,"_blank","noopener")}),c.push(e)}return H.build("div",{className:"mdc-card mdc-card--outlined flex-shrink--0",id:"card-"+t.id},[r,H.build("div",{className:"mdc-card__actions"},[H.build("div",{className:"mdc-card__action-buttons"},[l]),H.build("div",{className:"mdc-card__action-icons"},c)])])}static update(t,e){const s=e.querySelector("#box-card-nomination-result"),i=m.getTypeByCode(t.status.code);e.querySelector("#text-card-nomination-interval").innerHTML=t.intervalString,t.status.code>0?(s.hidden=!1,s.querySelector("i").innerHTML=m.types.get(i).icon,s.querySelector("span").innerHTML=t.resultDateString):s.hidden=!0;const n=e.querySelector(".mdc-card__action-buttons > button");n.className="mdc-button mdc-card__action mdc-card__action--button status-"+i,n.querySelector("i").innerHTML=t.status.icon,n.querySelector("span").innerHTML=a.a.t(t.status.title)}static updateLocation(t,e){const s=!t.lngLat;if(e.querySelector("#button-card-nomination-location").hidden=s,!b.fullFeature)return;e.querySelector("#button-card-nomination-intel").hidden=s}};var kt=class extends F{constructor(){super(...arguments),this.root=null,this.now=Date.now(),this.events={focus:()=>{},openDetails:()=>{}}}init(t){super.init(t),this.render()}render(){this.root=H.build("div",{className:["flex--1","flex-box-col","view-hide"].join(" "),cssText:["height: 100%","min-width: 300px","padding: 4px","box-sizing: border-box","overflow-y: scroll","scroll-behavior: smooth","-webkit-overflow-scrolling: touch"].join(";")}),this.parent.append(this.root)}clear(){this.root.innerHTML=""}show(t){this.clear();const e=t.map(t=>{const e=Lt.build(t,this.now,{openDetails:()=>this.events.openDetails(t),focus:()=>{console.log("focus"),this.events.focus(t)}});return Lt.update(t,e),t.lngLat&&Lt.updateLocation(t,e),e});this.root.append(...e)}updateVisibility(t,e){t.status instanceof p?e.hidden=!rt.reasons.get(t.status).checked:t.status instanceof u&&(e.hidden=!rt.types.get(t.status).checked)}update(t){const e=this.root.querySelector("#card-"+t.id);Lt.update(t,e),Lt.updateLocation(t,e),this.updateVisibility(t,e)}};var St=class extends F{constructor(){super(...arguments),this.ctrl=null,this.root=null}init(t){super.init(t),this.render()}render(){this.root=H.build("div",{className:"mdc-linear-progress",hidden:!0},[H.build("div",{className:"mdc-linear-progress__buffering-dots"}),H.build("div",{className:"mdc-linear-progress__buffer"}),H.build("div",{className:"mdc-linear-progress__bar mdc-linear"}),H.build("div",{className:["mdc-linear-progress__bar","mdc-linear-progress__primary-bar","mdc-linear-progress-bar-color--secondary"].join(" ")},[H.build("span",{className:"mdc-linear-progress__bar-inner"})]),H.build("div",{className:"mdc-linear-progress__bar mdc-linear-progress__secondary-bar"},[H.build("span",{className:"mdc-linear-progress__bar-inner"})])]),this.parent.append(this.root),this.ctrl=new P.linearProgress.MDCLinearProgress(this.root)}};var Mt=class{constructor(){this.appBar=new E,this.progress=new St,this.dashboard=new gt,this.list=new kt,this.dialog=new Nt,this.dark=new z}init(){document.documentElement.lang=a.a.language,O.a.accessToken="pk.eyJ1IjoibHVja2EtbWUiLCJhIjoiY2p2NDk5NmRvMHFreTQzbzduemM1MHV4cCJ9.7XGmxnEJRoCDr-i5BBmBfw";const t=document.body;t.className="mdc-typography fullheight flex-box-col",this.appBar.events.set(q.view.key,()=>this.switchView()),this.appBar.events.set(q.signin.key,()=>I.auth.signIn()),this.appBar.menu.events.set(A.open.key,()=>I.open()),this.appBar.menu.events.set(A.save.key,()=>I.save()),this.appBar.menu.events.set(A.upload.key,()=>I.upload()),this.appBar.menu.events.set(A.import.key,()=>this.dialog.import.open()),this.appBar.menu.events.set(A.about.key,()=>this.dialog.about.open()),this.appBar.menu.events.set(A.signout.key,()=>I.auth.signOut()),this.appBar.init(t),this.progress.init(t);const e=H.build("div",{className:["flex--1","flex-box-row--wrap","main-box"].join(" "),cssText:["min-height: 0%"].join(";")});function s(...t){window.dataLayer.push(arguments)}t.append(e),this.dashboard.map.events.focus=t=>{const e=this.list.root.offsetTop+8;this.list.root.scrollTo(0,document.getElementById("card-"+t).offsetTop-e)},this.dashboard.map.events.styleLoaded=()=>I.nominations,this.dashboard.filter.events.switchType=(t,e)=>{for(const s of I.nominations)m.typeMatched(s.status.code,t.code)&&(document.getElementById("card-"+s.id).hidden=!e);"rejected"===t.key&&this.dashboard.map.updateRejected(I.nominations),this.dashboard.map.setTypeVisible(t.key,e)},this.dashboard.filter.events.switchReason=(t,e)=>{for(const s of I.nominations)s.status.code===t.code&&(document.getElementById("card-"+s.id).hidden=!e);this.dashboard.map.updateRejected(I.nominations)},this.dashboard.bs.events.analyse=t=>I.bs.analyse(t),this.dashboard.bs.basic.events={refresh:()=>{I.updateBsData()},clear:()=>{I.clearBsData(),this.dashboard.bs.basic.update([])}},this.dashboard.init(e),this.list.events.focus=t=>{this.dashboard.map.easeTo(t.lngLat)},this.list.events.openDetails=t=>{this.dialog.details.open(t)},this.list.init(e),this.dialog.details.events.update=t=>{this.update(t)},this.dialog.details.events.query=(t,e,s)=>{I.bs.query(t,e,s)},this.dialog.details.map.events.queryLngLat=(t,e,s)=>{I.bs.queryLngLat(t,e,s)},this.dialog.import.events.import=t=>{I.import(t)},this.dialog.init(t),this.dark.changed=()=>{this.dashboard.updateStyle(),this.dialog.details.updateStyle()},this.dark.init(t),window.dataLayer=window.dataLayer||[],s("js",new Date),s("config","UA-167399687-2")}linkService(){I.events.authStatusChanged=t=>{t?(this.appBar.actions.get(q.signin.key).hidden=!0,this.appBar.menu.items.get(A.signout.key).hidden=!1):(this.clear(),this.appBar.actions.get(q.signin.key).hidden=!1,this.appBar.menu.items.get(A.signout.key).hidden=!0,this.appBar.menu.items.get(A.upload.key).hidden=!0,this.appBar.menu.items.get(A.import.key).hidden=!0)},I.events.progressUpdate=t=>{this.progress.ctrl.progress=t},I.events.updateBs=()=>{this.dashboard.bs.update(I.nominations)},I.events.showProgress=()=>{this.progress.root.hidden=!1},I.events.show=()=>{this.show()},I.events.clear=()=>{this.clear()},I.events.alert=t=>{this.dialog.alert.open(t)},I.events.info=t=>{this.dialog.shackbar.open(t)},I.file.local.events.openUI=t=>{this.openFileUI(t)},I.file.local.events.saveUI=(t,e)=>{this.saveFileUI(t,e)},I.mari.events.bufferUpdate=t=>{this.progress.ctrl.buffer=t},I.mari.events.progressUpdate=t=>{this.progress.ctrl.progress=.9*t}}switchView(){this.appBar.switchView(),this.dashboard.root.classList.toggle("view-hide"),this.list.root.classList.toggle("view-hide")}clear(){this.appBar.menu.items.get(A.open.key).hidden=!1,this.appBar.menu.items.get(A.save.key).hidden=!0,this.dashboard.setVisible(!1),this.list.clear(),this.dashboard.map.update(I.nominations),this.progress.root.hidden=!0,this.progress.ctrl.buffer=0,this.progress.ctrl.progress=0}show(){this.list.show(I.nominations),this.dashboard.setVisible(!0),this.dashboard.map.fit(I.nominations),this.dashboard.refresh(I.nominations),this.appBar.menu.items.get(A.open.key).hidden=!0,this.appBar.menu.items.get(A.save.key).hidden=!1,this.appBar.menu.items.get(A.upload.key).hidden=!I.auth.signedIn,this.appBar.menu.items.get(A.import.key).hidden=!1,this.progress.root.hidden=!0}update(t){this.list.update(t),this.dashboard.update(I.nominations)}openFileUI(t){const e=H.build("input",{cssText:"display:none;",type:"file",accept:"json"});e.addEventListener("change",t,!1),document.body.append(e),e.click(),setTimeout(()=>{e.remove()},1e3)}saveFileUI(t,e){const s=H.build("a",{cssText:"display:none",href:e,download:t});document.body.append(s),s.click(),s.remove()}};s(15),s(16);I.init();const _t=new Mt;_t.init(),_t.linkService()}]);