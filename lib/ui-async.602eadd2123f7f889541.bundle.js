(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{60:function(t,e,a){"use strict";a.r(e);var s=a(41),i=a.n(s),n=a(1),o=a(5),l=a(42),r=a.n(l);class d extends o.a{constructor(){super(),this.root=null,Object.defineProperty(this,"root",{enumerable:!1})}update(t){}updateStyle(){}setVisible(t){if(!this.root){if(!t)return;this.render()}this.root.hidden=!t}}class c extends d{constructor(){super(...arguments),this.chart=null}static get color(){return{border:"rgba(0, 0, 0, 0.2)",borderHover:"rgba(0, 0, 0, 0.4)"}}static buildChartCard(t,e,a,s){return n.a.build("div",{className:["mdc-card","mdc-card--outlined","padding--8","flex--"+a,"flex-shrink--1"].join(" "),cssText:`min-width:${s}px`},[n.a.build("span",{className:"mdc-typography--headline6",innerHTML:t}),n.a.build("div",{className:"container-chart"},[e])])}static fillTimeDataMap(t,e,a){let s=e;for(;s<=a;){const e=r()(s+1e3).startOf("month"),a=e.valueOf();t.has(a)||t.set(a,0),s=e.endOf("month").valueOf()}}}var u=a(3),h=a(14);class m extends d{updateStats(t){}}class p extends m{constructor(){super(...arguments),this.chart=null}static buildChartCard(t,e,a,s){return c.buildChartCard(t,e,a,s)}static fillTimeDataMap(t,e,a){c.fillTimeDataMap(t,e,a)}}var b=class extends m{constructor(){super(...arguments),this.textReviews=null,this.textSubtitle=null,this.actionRefresh=null,this.events={refresh:()=>{},clear:()=>{}}}render(){this.textReviews=n.a.build("span",{cssText:"font-weight:300;font-size:4.5rem;line-height:4.5rem;",innerHTML:"0"}),this.textSubtitle=n.a.build("span",{className:"mdc-typography--body1 text-nowrap",innerHTML:u.a.t("ui.dashboard.brainstorming.basic.desc",{count:0})}),this.actionRefresh=n.a.build("button",{className:"mdc-button mdc-card__action mdc-card__action--button",disabled:!0},[n.a.build("div",{className:"mdc-button__ripple"}),n.a.build("i",{className:"fa fa-fw mdc-button__icon",innerHTML:""}),n.a.build("span",{className:"mdc-button__label",innerHTML:u.a.t("ui.dashboard.brainstorming.basic.refresh")})]);const t=new h.a(this.actionRefresh);t.unbounded=!0,t.listen("click",(()=>{this.actionRefresh.disabled=!0,this.events.refresh()}));const e=n.a.build("button",{className:["fa","mdc-icon-button","mdc-card__action","mdc-card__action--icon"].join(" "),title:u.a.t("ui.dashboard.brainstorming.basic.clear"),id:"button-card-nomination-location",innerHTML:""}),a=new h.a(e);a.unbounded=!0,a.listen("click",(()=>{this.events.clear()})),this.root=n.a.build("div",{className:["mdc-card","mdc-card--outlined","flex--1","flex-shrink--1"].join(" ")},[n.a.build("div",{className:["flex-box-col","padding--8","flex-grow--1","flex-justify-content--between"].join(" ")},[n.a.build("span",{className:"mdc-typography--headline6",innerHTML:u.a.t("ui.dashboard.brainstorming.basic.title")}),this.textReviews,this.textSubtitle]),n.a.build("div",{className:"mdc-card__actions"},[n.a.build("div",{className:"mdc-card__action-buttons"},[this.actionRefresh]),n.a.build("div",{className:"mdc-card__action-icons"},[e])])]),this.setVisible(!1),this.parent.append(this.root)}updateStats(t){this.textReviews.innerHTML=""+t.review,this.textSubtitle.innerHTML=u.a.t("ui.dashboard.brainstorming.basic.desc",{count:t.nomination}),this.actionRefresh.disabled=!1}},g=a(18);var f=class extends p{render(){const t=n.a.build("canvas",{className:"canvas-chart--h"});this.root=p.buildChartCard(u.a.t("ui.dashboard.brainstorming.rates.title"),t,1,240),this.setVisible(!1),this.parent.append(this.root);const e=[];for(const t of Object.values(g.a))e.push(u.a.t(t));const a=getComputedStyle(document.documentElement);this.chart=new i.a(t.getContext("2d"),{type:"radar",data:{labels:e,datasets:[{data:[],borderColor:a.getPropertyValue("--mdc-theme-primary"),pointRadius:0}]},options:{legend:{display:!1},scale:{ticks:{display:!1,min:1,max:5,stepSize:1},angleLines:{color:a.getPropertyValue("--mdc-theme-text-disabled-on-light")},gridLines:{color:a.getPropertyValue("--mdc-theme-text-disabled-on-light")}}}})}updateStats(t){const e=[];for(const a of Object.keys(g.a)){const s=t.rate.get(a),i=s.reduce(((t,e)=>t+e),0)/s.length;e.push(parseFloat(i.toFixed(2)))}this.chart.data.datasets[0].data=e,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].borderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.options.scale.angleLines.color=t.getPropertyValue("--mdc-theme-text-disabled-on-light"),this.chart.options.scale.gridLines.color=t.getPropertyValue("--mdc-theme-text-disabled-on-light"),this.chart.update()}};var y=class extends p{render(){const t=n.a.build("canvas",{className:"canvas-chart--h"});this.root=p.buildChartCard(u.a.t("ui.dashboard.brainstorming.reviews.title"),t,3,300),this.setVisible(!1),this.parent.append(this.root);const e=getComputedStyle(document.documentElement);this.chart=new i.a(t.getContext("2d"),{type:"line",data:{labels:[],datasets:[{label:u.a.t("ui.dashboard.brainstorming.reviews.desc"),data:[],borderColor:e.getPropertyValue("--mdc-theme-primary"),pointRadius:0}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{type:"time",time:{unit:"month",tooltipFormat:"YYYY-MM",displayFormats:{month:"YYYY-MM"}}}]}}})}updateStats(t){if(t.reviewTimes.length<1)return this.chart.data.datasets[0].data=[],void this.chart.update();const e=new Map;let a=r()(t.reviewTimes[0]).startOf("month").valueOf(),s=a;for(const i of t.reviewTimes){const t=r()(i).startOf("month").valueOf();t<a?a=t:t>s&&(s=t),e.has(t)?e.set(t,e.get(t)+1):e.set(t,1)}p.fillTimeDataMap(e,a,s);const i=[];e.forEach(((t,e)=>{i.push({t:e,y:t})})),i.sort(((t,e)=>t.t-e.t)),this.chart.data.datasets[0].data=i,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].borderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.update()}};var v=class extends m{constructor(){super(...arguments),this.textSynch=null}render(){this.textSynch=n.a.build("span",{cssText:"font-weight:300;font-size:6rem;line-height:6rem;",innerHTML:"0.0"}),this.root=n.a.build("div",{className:["mdc-card","mdc-card--outlined","padding--8","flex--1","flex-shrink--1","flex-justify-content--between"].join(" ")},[n.a.build("span",{className:"mdc-typography--headline6",innerHTML:u.a.t("ui.dashboard.brainstorming.synch.title")}),n.a.build("span",{className:"text-nowarp"},[this.textSynch,n.a.build("span",{cssText:"font-size:2rem;line-height:2rem;",innerHTML:"%"})]),n.a.build("span",{className:"mdc-typography--body1 text-nowarp",innerHTML:u.a.t("ui.dashboard.brainstorming.synch.desc")})]),this.setVisible(!1),this.parent.append(this.root)}updateStats(t){const e=t.synch.total>0?t.synch.synched/t.synch.total:0;this.textSynch.innerHTML=""+(100*e).toFixed(1)}};var x=class extends d{constructor(){super(),this.basic=new b,this.rates=new f,this.synch=new v,this.reviews=new y,this.events={analyse:()=>({review:0,nomination:0,rate:new Map,reviewTimes:[],synch:{total:0,synched:0}})},Object.defineProperty(this,"events",{enumerable:!1})}init(t){this.forEach((e=>{e.init(t)}))}update(t){const e=this.events.analyse(t);this.forEach((t=>{t.updateStats(e)}))}updateStyle(){this.forEach((t=>{t.updateStyle()}))}setVisible(t){this.forEach((e=>{e.setVisible(t)}))}forEach(t){Object.values(this).forEach(t)}};var w=class extends c{render(){const t=n.a.build("canvas",{className:"canvas-chart--h"});this.root=c.buildChartCard(u.a.t("ui.dashboard.count-by-month.title"),t,3,300),this.setVisible(!1),this.parent.append(this.root);const e=getComputedStyle(document.documentElement),a=e.getPropertyValue("--mdc-theme-primary"),s=e.getPropertyValue("--mdc-theme-secondary");this.chart=new i.a(t.getContext("2d"),{type:"line",data:{labels:[],datasets:[{label:u.a.t("ui.dashboard.count-by-month.submissions"),data:[],borderColor:a,pointBackgroundColor:a,pointRadius:0,fill:!1},{label:u.a.t("ui.dashboard.count-by-month.results"),data:[],borderColor:s,pointBackgroundColor:s,pointRadius:0,fill:!1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{type:"time",time:{unit:"month",tooltipFormat:"YYYY-MM",displayFormats:{month:"YYYY-MM"}}}]},tooltips:{mode:"x"}}})}update(t){if(0===t.length)return this.chart.data.datasets[0].data=[],this.chart.data.datasets[1].data=[],void this.chart.update();const e=new Map,a=new Map;let s=r()(t[0].confirmedTime).startOf("month").valueOf(),i=s;for(const n of t){const t=r()(n.confirmedTime).startOf("month").valueOf();if(t<s?s=t:t>i&&(i=t),e.has(t)?e.set(t,e.get(t)+1):e.set(t,1),!n.resultTime)continue;const o=r()(n.resultTime).startOf("month").valueOf();o>i&&(i=o),a.has(o)?a.set(o,a.get(o)+1):a.set(o,1)}c.fillTimeDataMap(e,s,i),c.fillTimeDataMap(a,s,i);const n=[],o=[];e.forEach(((t,e)=>{n.push({t:e,y:t})})),a.forEach(((t,e)=>{o.push({t:e,y:t})})),n.sort(((t,e)=>t.t-e.t)),o.sort(((t,e)=>t.t-e.t)),this.chart.data.datasets[0].data=n,this.chart.data.datasets[1].data=o,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].borderColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.data.datasets[1].borderColor=t.getPropertyValue("--mdc-theme-secondary"),this.chart.update()}},T=a(66),N=a(0);class k extends d{constructor(){super(...arguments),this.block={type:{root:null},reason:{root:null}},this.types=new Map,this.reasons=new Map,this.events={switchType:()=>{},switchReason:()=>{}}}render(){this.block.type.root=n.a.build("div",{className:"flex-box-row--nowrap"}),this.block.reason.root=n.a.build("div",{cssText:"overflow-y: auto;",className:"flex-box-row--wrap"}),this.root=n.a.build("div",{className:["mdc-card","mdc-card--outlined","padding--8","flex--2","flex-shrink--0"].join(" "),cssText:"min-width: 250px"},[n.a.build("span",{className:"mdc-typography--headline6",innerHTML:u.a.t("ui.dashboard.filter.title")}),n.a.build("span",{className:"mdc-typography--subtitle1",innerHTML:u.a.t("ui.dashboard.filter.type")}),this.block.type.root,n.a.build("span",{className:"mdc-typography--subtitle1",innerHTML:u.a.t("ui.dashboard.filter.rejected")}),this.block.reason.root]),this.setVisible(!1),this.parent.append(this.root);for(const t of N.a.status.reasons.values()){const e=k.buildSwitch(this.block.reason,t,"rejected");e.listen("change",(()=>{this.switchReason(t,e.checked)})),this.reasons.set(t,e)}for(const t of N.a.status.types.values()){const e=k.buildSwitch(this.block.type,t,t.key);e.listen("change",(()=>this.switchType(t,e.checked))),this.types.set(t,e)}}switchType(t,e){if(t.code>100)for(const t of this.reasons.values())t.checked=e;this.events.switchType(t,e)}switchReason(t,e){this.events.switchReason(t,e);const a=N.a.status.types.get("rejected");e&&!this.types.get(a).checked&&(this.types.get(a).checked=!0,this.events.switchType(a,!0))}getFilter(t){const e=new Map;for(const[a,s]of t.entries())s.checked&&e.set(a.code,s.checked);return e}get typeFilter(){return this.getFilter(this.types)}get reasonFilter(){return this.getFilter(this.reasons)}static buildSwitch(t,e,a){const s="switch-filter-"+e.key,i=n.a.build("div",{className:"mdc-switch"},[n.a.build("div",{className:"mdc-switch__track"}),n.a.build("div",{className:"mdc-switch__thumb-underlay",id:s},[n.a.build("div",{className:"mdc-switch__thumb"},[n.a.build("input",{type:"checkbox",className:"mdc-switch__native-control",role:"switch"})])])]),o=n.a.build("div",{className:"mdc-switch-box margin-h--4"},[i,n.a.build("label",{className:"fa fa-fw status-"+a,for:s,title:u.a.t(e.title),innerHTML:e.icon})]);t.root.append(o);const l=new T.a(i);return l.checked=!0,l}}var _=a(47),L=a.n(_);a(53);class C extends d{constructor(){super(...arguments),this.ctrl=null,this.events={focus:()=>{},styleLoaded:()=>[]},this.enabledReasons=[],this.tasks=[]}render(){const t=n.a.build("div",{cssText:["width: 100%","height: 100%","clip-path: inset(100% round 4px)","-webkit-clip-path: inset(0 round 4px)"].join(";")});this.root=n.a.build("div",{className:"mdc-card mdc-card--outlined flex--3 flex-shrink--1",cssText:"min-width: 300px;"},[t]),this.parent.append(this.root),L.a.accessToken="pk.eyJ1IjoibHVja2EtbWUiLCJhIjoiY2p2NDk5NmRvMHFreTQzbzduemM1MHV4cCJ9.7XGmxnEJRoCDr-i5BBmBfw",this.ctrl=new L.a.Map({container:t,style:C.getStyle()}),this.ctrl.on("idle",(()=>this.executeTasks())),this.ctrl.addControl(new L.a.NavigationControl),this.ctrl.addControl(new L.a.FullscreenControl),this.resize()}get loaded(){return this.ctrl&&this.ctrl.isStyleLoaded()}update(t){this.loaded?(this.updateRejected(t),this.updateSource("accepted",C.generateGeoJSON(t,[N.a.status.types.get("accepted").code])),this.updateSource("pending",C.generateGeoJSON(t,[N.a.status.types.get("pending").code]))):this.tasks.push((()=>this.update(t)))}updateStyle(){this.loaded?(this.ctrl.setStyle(C.getStyle()),this.update(this.events.styleLoaded())):this.tasks.push((()=>this.updateStyle()))}set reasonFilter(t){this.enabledReasons=[];for(const[e,a]of t.entries())a&&this.enabledReasons.push(e)}setTypeVisible(t,e){if(!this.loaded)return void this.tasks.push((()=>this.setTypeVisible(t,e)));const a=e?"visible":"none";this.ctrl.setLayoutProperty(`potori-${t}-cluster`,"visibility",a),this.ctrl.setLayoutProperty(`potori-${t}-count`,"visibility",a),this.ctrl.setLayoutProperty(`potori-${t}-unclustered`,"visibility",a)}easeTo(t){if(!this.loaded)return void this.tasks.push((()=>this.easeTo(t)));const e=this.ctrl.getZoom();this.ctrl.easeTo({center:t,zoom:e<15?15:e})}resize(){this.loaded?this.ctrl.resize():this.tasks.push((()=>this.resize()))}fit(t){if(!this.loaded)return void this.tasks.push((()=>this.fit(t)));const e={lng:-181,lat:-91},a={lng:181,lat:91};for(const s of t)s.lngLat&&(s.lngLat.lng>e.lng&&(e.lng=s.lngLat.lng),s.lngLat.lng<a.lng&&(a.lng=s.lngLat.lng),s.lngLat.lat>e.lat&&(e.lat=s.lngLat.lat),s.lngLat.lat<a.lat&&(a.lat=s.lngLat.lat));a.lng>-181&&this.ctrl.fitBounds([a,e],{linear:!0})}updateRejected(t){this.loaded?this.updateSource("rejected",C.generateGeoJSON(t,this.enabledReasons)):this.tasks.push((()=>this.updateRejected(t)))}executeTasks(){const t=this.tasks.length;for(let e=0;e<t;e++)this.tasks.shift()()}updateSource(t,e){const a="potori-"+t,s=this.ctrl.getSource(a);if(s)return void s.setData(e);this.ctrl.addSource(a,{type:"geojson",data:e,cluster:!0});const i=getComputedStyle(document.documentElement),n=i.getPropertyValue("--color-"+t),o=i.getPropertyValue(`--color-${t}--dark`);this.ctrl.addLayer({id:a+"-cluster",type:"circle",source:a,filter:["has","point_count"],paint:{"circle-color":n,"circle-opacity":.6,"circle-stroke-width":4,"circle-stroke-color":o,"circle-radius":["step",["get","point_count"],20,50,30,100,40]}}),this.ctrl.addLayer({id:a+"-count",type:"symbol",source:a,filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":getComputedStyle(document.documentElement).getPropertyValue("--mdc-theme-on-surface")}}),this.ctrl.addLayer({id:a+"-unclustered",type:"circle",source:a,filter:["!",["has","point_count"]],paint:{"circle-color":n,"circle-radius":5,"circle-stroke-width":2,"circle-stroke-color":o}}),this.ctrl.on("click",a+"-cluster",(t=>{const e=this.ctrl.queryRenderedFeatures(t.point,{layers:[a+"-cluster"]}),s=e[0].properties.cluster_id;this.ctrl.getSource(a).getClusterExpansionZoom(s,((t,a)=>{t||this.ctrl.easeTo({center:e[0].geometry.coordinates,zoom:a})}))})),this.ctrl.on("click",a+"-unclustered",(t=>{t.features[0].geometry.coordinates;const e=t.features[0].geometry.coordinates;for(;Math.abs(t.lngLat.lng-e[0])>180;)e[0]+=t.lngLat.lng>e[0]?360:-360;(new L.a.Popup).setLngLat(e).setText(t.features[0].properties.title).addTo(this.ctrl),this.events.focus(t.features[0].properties.id)}))}static generateGeoJSON(t,e){const a={type:"FeatureCollection",features:[]};if(e.length<1)return a;for(const s of t)e.includes(s.status.code)&&s.lngLat&&a.features.push({type:"Feature",properties:{id:s.id,title:s.title,status:s.status},geometry:{type:"Point",coordinates:[s.lngLat.lng,s.lngLat.lat]}});return a}static getStyle(){return`mapbox://styles/mapbox/${getComputedStyle(document.documentElement).getPropertyValue("--map-style").trim()}?optimize=true`}}var S=C;var M=class extends c{render(){const t=n.a.build("canvas",{className:"canvas-chart--h"});this.root=c.buildChartCard(u.a.t("ui.dashboard.quotas.title"),t,2,200),this.setVisible(!1),this.parent.append(this.root);const e=[];for(let t=0;t<14;t++)e.push(""+t);const a=getComputedStyle(document.documentElement);this.chart=new i.a(t.getContext("2d"),{type:"bar",data:{labels:e,datasets:[{data:[],backgroundColor:a.getPropertyValue("--mdc-theme-primary"),hoverBackgroundColor:a.getPropertyValue("--mdc-theme-primary")}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{beginAtZero:!0}}],xAxes:[{scaleLabel:{display:!0,labelString:u.a.t("ui.dashboard.quotas.xAxis")}}]}}})}update(t){const e=new Array(14).fill(0),a=Date.now();for(const s of t){const t=s.restoreTime;t>a&&(e[Math.floor((t-a)/864e5)]+=1)}this.chart.data.datasets[0].data=e,this.chart.update()}updateStyle(){if(!this.chart)return;const t=getComputedStyle(document.documentElement);this.chart.data.datasets[0].backgroundColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.data.datasets[0].hoverBackgroundColor=t.getPropertyValue("--mdc-theme-primary"),this.chart.update()}};class R extends c{render(){const t=n.a.build("canvas",{className:"canvas-chart--v"});this.root=c.buildChartCard(u.a.t("ui.dashboard.stats-rejected.title"),t,3,300),this.setVisible(!1),this.parent.append(this.root),this.chart=new i.a(t.getContext("2d"),{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],borderAlign:"inner",borderColor:R.color.border,hoverBackgroundColor:[],hoverBorderColor:R.color.borderHover}]},options:{legend:{display:!0,position:"right"}}})}update(t){const e=new Map;for(const t of N.a.status.reasons.values())e.set(t,0);t.reduce(((t,e)=>{if(e.status.code<100)return t;const a=e.status;return t.set(a,t.get(a)+1),t}),e);const a=[],s=[],i=[];for(const[t,n]of e.entries())n<1||(a.push(u.a.t(t.title)),s.push(t.color),i.push(n));this.chart.data.labels=a,this.chart.data.datasets[0].data=i,this.chart.data.datasets[0].backgroundColor=s,this.chart.data.datasets[0].hoverBackgroundColor=s,this.chart.update()}}var j=R;class H extends c{render(){const t=n.a.build("canvas",{className:"canvas-chart--v"});this.root=c.buildChartCard(u.a.t("ui.dashboard.stats-type.title"),t,2,250),this.setVisible(!1),this.parent.append(this.root),this.chart=new i.a(t.getContext("2d"),{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],borderAlign:"inner",borderColor:H.color.border,hoverBackgroundColor:[],hoverBorderColor:H.color.borderHover}]},options:{legend:{display:!0,position:"right"}}})}update(t){const e=new Map;for(const t of N.a.status.types.values())e.set(t.key,0);t.reduce(((t,e)=>{const a=e.status.code>100?"rejected":e.status.key;return t.set(a,t.get(a)+1),t}),e);const a=[],s=[],i=[],n=getComputedStyle(document.documentElement);for(const[t,o]of e.entries()){if(o<1)continue;const e=N.a.status.types.get(t);a.push(u.a.t(e.title)),s.push(n.getPropertyValue("--color-"+t)),i.push(o)}this.chart.data.labels=a,this.chart.data.datasets[0].data=i,this.chart.data.datasets[0].backgroundColor=s,this.chart.data.datasets[0].hoverBackgroundColor=s,this.chart.update()}}var D=H;class O extends o.a{constructor(){super(),this.root=null,this.map=new S,this.filter=new k,this.statsType=new D,this.statsRejected=new j,this.countByMonth=new w,this.quotas=new M,this.bs=new x,Object.defineProperty(this,"root",{enumerable:!1})}init(t){super.init(t),i.a.defaults.global.legend.labels.boxWidth=10,i.a.defaults.global.maintainAspectRatio=!1,i.a.defaults.line.tooltips={intersect:!1},i.a.defaults.doughnut.tooltips={callbacks:{label:(t,e)=>{const a=e.datasets[t.datasetIndex],s=a._meta,i=s[Object.keys(s)[0]].data,n=a.data.reduce(((t,e,a)=>t+(i[a].hidden?0:e)),0),o=a.data[t.index],l=(o/n*100).toFixed(2);return`${e.labels[t.index]}: ${o} (${l}%)`}}},i.a.defaults.radar.tooltips={intersect:!1,callbacks:{title:(t,e)=>e.labels[t[0].index]}},this.render(),this.forEach((t=>{t.init(this.root)}))}render(){this.root=n.a.build("div",{className:["flex--2","flex-box-row--wrap","flex-align-items--start","flex-align-content--start","padding--4","dashboard"].join(" "),cssText:["height: 100%","box-sizing: border-box","overflow-y: auto","scroll-behavior: smooth","-webkit-overflow-scrolling: touch"].join(";")}),this.parent.append(this.root)}refresh(t){this.map.reasonFilter=this.filter.reasonFilter,this.forEach((e=>{e.update(t)}))}update(t){this.map.reasonFilter=this.filter.reasonFilter,this.map.update(t),this.statsType.update(t),this.statsRejected.update(t),this.countByMonth.update(t),this.bs.update(t)}updateStyle(){this.forEach((t=>{t.updateStyle()}))}setVisible(t){this.forEach((e=>{e.setVisible(t)})),this.map.resize()}forEach(t){Object.values(this).forEach(t)}}e.default=O},64:function(t,e,a){"use strict";a.r(e);var s=a(3),i=a(63),n=a(38),o=a(68),l=a(67),r=a(14),d=a(61),c=a(1),u=a(0),h=a(8),m=a(47),p=a.n(m),b=a(5);class g extends b.a{constructor(){super(...arguments),this.ctrl=null,this.marker=null,this.dialog=null,this.nomination=null,this.buttons={edit:{root:null,icon:"",clicked:()=>this.edit()},search:{root:null,icon:"",clicked:()=>this.search()},delete:{root:null,icon:"",clicked:()=>this.delete()}},this.events={alert:()=>{},queryLngLat:()=>{}}}init(t){super.init(t),this.render()}render(){const t=[];for(const e of Object.values(this.buttons)){e.root=c.a.build("button",{className:"fa mdc-icon-button",innerHTML:e.icon});const a=new r.a(e.root);a.unbounded=!0,a.listen("click",e.clicked),t.push(e.root)}const e=c.a.build("div",{className:"flex-grow--1",cssText:"min-height: 180px"}),a=c.a.build("div",{className:"flex-box-row--nowrap margin-v--8"},[c.a.build("div",{className:"flex-box-col flex-justify-content--around"},t),e]);this.parent.append(a),this.ctrl=new p.a.Map({container:e,style:g.getStyle()}),this.ctrl.addControl(new p.a.NavigationControl)}set(t){this.nomination=t,this.delete(),this.nomination.lngLat&&a.e(0).then(a.t.bind(null,47,7)).then((t=>{this.marker=(new t.Marker).setLngLat(this.nomination.lngLat).addTo(this.ctrl),this.ctrl.jumpTo({center:this.nomination.lngLat,zoom:16}),this.buttons.delete.root.disabled=!1,this.buttons.edit.root.innerHTML=""})),this.buttons.search.root.disabled=!1}edit(){this.marker?this.marker.setDraggable(!0):a.e(0).then(a.t.bind(null,47,7)).then((t=>{this.marker=(new t.Marker).setLngLat(this.ctrl.getCenter()).setDraggable(!0).addTo(this.ctrl),this.buttons.delete.root.disabled=!1,this.buttons.edit.root.innerHTML=""}))}search(){this.buttons.search.root.disabled=!0,this.events.queryLngLat(this.nomination,(t=>{this.dialog.isOpen&&(this.marker?(this.marker.setLngLat(t),this.marker.setDraggable(!1)):a.e(0).then(a.t.bind(null,47,7)).then((e=>{this.marker=(new e.Marker).setLngLat(t).setDraggable(!1).addTo(this.ctrl)})),this.ctrl.easeTo({center:t,zoom:16}),this.buttons.edit.root.innerHTML="",this.buttons.search.root.disabled=!1,this.buttons.delete.root.disabled=!1)}),(t=>{this.dialog.isOpen&&(this.events.alert(s.a.t(t)),this.buttons.search.root.disabled=!1)}))}delete(){this.marker&&this.marker.remove(),this.marker=null,this.buttons.edit.root.innerHTML="",this.buttons.delete.root.disabled=!0}updateStyle(){this.ctrl&&this.ctrl.setStyle(g.getStyle())}static getStyle(){return`mapbox://styles/mapbox/${getComputedStyle(document.documentElement).getPropertyValue("--map-style").trim()}?optimize=true`}}class f extends h.a{constructor(){super(...arguments),this.nomination=null,this.headingTitle=null,this.image=null,this.textConfirmedTime=null,this.status=new Map,this.selectedStatus=null,this.fieldResultTime=null,this.blockReason=null,this.fieldReason=null,this.chipSetReason=null,this.map=new g,this.events={alert:()=>{},query:()=>{},update:()=>{}}}render(){this.headingTitle=c.a.build("h2",{className:"mdc-dialog__title",dataset:{mdcDialogInitialFocus:""},innerHTML:""}),this.image=c.a.build("img",{cssText:["object-fit:cover","object-position:center","width:100%","height:150px;"].join(";")}),this.textConfirmedTime=c.a.build("span",{className:"margin-l--4"});const t=[];for(const e of u.a.status.types.keys()){const a="radio-dialog-details-status-"+e,s=c.a.build("input",{type:"radio",className:"mdc-radio__native-control",name:"radio-dialog-details-status",value:e});s.addEventListener("change",(t=>{const e=t.target;this.selectedStatus=e.value,this.fieldResultTime.root.hidden="pending"===e.value,this.fieldResultTime.layout(),this.blockReason.hidden=!("rejected"===e.value),this.map.ctrl.resize()}));const i=c.a.build("div",{className:"mdc-radio"},[s,c.a.build("div",{className:"mdc-radio__background"},[c.a.build("div",{className:"mdc-radio__outer-circle"}),c.a.build("div",{className:"mdc-radio__inner-circle"})])]),n=c.a.build("div",{className:"mdc-form-field"},[i,c.a.build("label",{for:a,className:"fa status-"+e,innerHTML:u.a.status.types.get(e).icon})]),r=new l.a(i);this.status.set(e,r);new o.a(n).input=r,t.push(n)}const e=f.buildTextField("input-dialog-details-result-time","fullwidth","",s.a.t("ui.dialog.details.resultTime"),"datetime-local");this.fieldResultTime=new d.a(e);const a=f.buildTextField("input-dialog-details-reason","flex--1","",s.a.t("ui.dialog.details.reason"),"text");this.fieldReason=new d.a(a),this.fieldReason.disabled=!0;const m=[];for(const[t,e]of u.a.status.reasons.entries())m.push(c.a.build("div",{className:"mdc-chip",id:"details-reason-"+t,role:"row"},[c.a.build("div",{className:"mdc-chip__ripple"}),c.a.build("span",{role:"gridcell"},[c.a.build("span",{className:"mdc-chip__primary-action",role:"button"},[c.a.build("span",{className:"mdc-chip__text",innerHTML:s.a.t(e.title)})])])]));const p=c.a.build("div",{className:"mdc-chip-set mdc-chip-set--choice",role:"grid",hidden:!0},m);this.chipSetReason=new i.a(p);const b=c.a.build("button",{className:"fa mdc-icon-button margin-l--8",innerHTML:"&#xf107"}),g=new r.a(b);g.unbounded=!0,g.listen("click",(()=>{p.hidden=!p.hidden,b.innerHTML=p.hidden?"&#xf107":"&#xf106",this.map.ctrl.resize()})),this.blockReason=c.a.build("div",{className:"fullwidth"},[c.a.build("div",{className:"fullwidth flex-box-row--nowrap flex-align-items--center"},[a,b]),p]),this.chipSetReason.chips.forEach((t=>{t.listen("MDCChip:selection",(()=>{const t=this.chipSetReason.selectedChipIds.length>0?this.chipSetReason.selectedChipIds[0].replace("details-reason-",""):"undeclared",e=u.a.status.reasons.get(t);this.fieldReason.leadingIconContent=e.icon,this.fieldReason.value=s.a.t(e.title)}))}));const y=c.a.build("div",{className:"mdc-dialog__content"},[c.a.build("div",{className:["mdc-typography--body1","flex-box-row--nowrap","flex-align-items--center"].join(" ")},[c.a.icon("&#xf062"),this.textConfirmedTime]),c.a.build("div",{className:["fullwidth","flex-box-row--nowrap","flex-justify-content--around"].join(" ")},t),e,this.blockReason]);this.map.init(y);const v=h.a.buildDialog([this.headingTitle,this.image,y,c.a.build("footer",{className:"mdc-dialog__actions"},[h.a.buildDialogAction("close",s.a.t("ui.dialog.close")),h.a.buildDialogAction("save",s.a.t("ui.dialog.details.save"))])]);this.parent.append(v),this.ctrl=new n.a(v),this.ctrl.listen("MDCDialog:opened",(()=>this.opened())),this.ctrl.listen("MDCDialog:closed",(t=>this.closed(t))),this.map.dialog=this.ctrl,g.layout()}opened(){this.fieldResultTime.layout(),this.fieldReason.layout(),this.map.ctrl.resize()}closed(t){if("save"!==t.detail.action)return;const e=u.a.status.getTypeByCode(this.nomination.status.code),a=u.a.status.getReasonByCode(this.nomination.status.code),i=this.selectedStatus;let n=!1;if("pending"!==i){const t=Date.parse(this.fieldResultTime.value);if(!t)return void this.events.alert(s.a.t("message:ui.dialog.details.invalidTime"));const e=t+6e4*(new Date).getTimezoneOffset();this.nomination.resultTime&&Math.floor(this.nomination.resultTime/6e4)===Math.floor(e/6e4)||(this.nomination.resultTime=e,n=!0)}const o=this.chipSetReason.selectedChipIds.length>0?this.chipSetReason.selectedChipIds[0].replace("details-reason-",""):"undeclared";if((i!==e||"rejected"===e&&a.key!==o)&&(n=!0),this.map.marker){const t=this.map.marker.getLngLat();this.nomination.lngLat&&this.nomination.lngLat.lng===t.lng&&this.nomination.lngLat.lat===t.lat||(this.nomination.lngLat=t,n=!0)}else this.nomination.lngLat&&(this.nomination.lngLat=null,n=!0);n&&("rejected"!==this.selectedStatus?this.nomination.status=u.a.status.types.get(this.selectedStatus):this.nomination.status=u.a.status.reasons.get(o),this.events.update(this.nomination))}open(t){this.ctrl||this.render(),this.nomination=t,this.map.set(t);const e=u.a.status.getTypeByCode(t.status.code);this.headingTitle.innerHTML=t.title,this.image.src=t.imageUrl,this.textConfirmedTime.innerHTML=new Date(t.confirmedTime).toLocaleString(),this.fieldResultTime.root.hidden="pending"===e;const a=t=>{const e=new Date;return e.setTime(t-6e4*e.getTimezoneOffset()),e.toISOString()},i=a(t.resultTime?t.resultTime:Date.now());if(this.fieldResultTime.value=i.slice(0,i.lastIndexOf(":")),this.blockReason.hidden=!("rejected"===e),"rejected"===e){const e="details-reason-"+t.status.key;this.chipSetReason.chips.forEach((t=>{t.selected=t.id===e})),this.fieldReason.leadingIconContent=t.status.icon,this.fieldReason.value=s.a.t(t.status.title)}"pending"===e&&this.events.query(t,(t=>{const e=a(t.lastTime);this.fieldResultTime.value=e.slice(0,e.lastIndexOf(":")),this.fieldResultTime.layout()}),(()=>{})),this.status.get(e).checked=!0,this.selectedStatus=e,this.ctrl.open()}updateStyle(){this.map.updateStyle()}static buildNotchedOutline(t){return t.className="mdc-floating-label",c.a.build("div",{className:"mdc-notched-outline"},[c.a.build("div",{className:"mdc-notched-outline__leading"}),c.a.build("div",{className:"mdc-notched-outline__notch"},[c.a.build("label",t)]),c.a.build("div",{className:"mdc-notched-outline__trailing"})])}static buildTextField(t,e,a,s,i){return c.a.build("div",{className:["mdc-text-field","mdc-text-field--outlined","mdc-text-field--with-leading-icon","margin-v--8",e].join(" ")},[c.a.build("i",{className:["fa","mdc-text-field__icon","mdc-text-field__icon--leading"].join(" "),innerHTML:a}),c.a.build("input",{type:i,className:"mdc-text-field__input",id:t}),f.buildNotchedOutline({for:t,innerHTML:s})])}}e.default=f},65:function(t,e,a){"use strict";a.r(e);var s=a(3),i=a(1),n=a(0),o=a(5),l=a(14);class r{static build(t,e,a){const s=["margin-r--8","flex-box-row--nowrap","flex-align-items--center"].join(" "),o=[];o.push(i.a.build("span",{className:s},[i.a.icon("&#xf062"),i.a.build("span",{className:"margin-l--4",innerHTML:t.confirmedDateString})]));t.restoreTime>e&&o.push(i.a.build("span",{className:s},[i.a.icon("&#xf2f9"),i.a.build("span",{className:"margin-l--4",innerHTML:t.restoreIntervalString})])),o.push(i.a.build("span",{className:s},[i.a.icon("&#xf017"),i.a.build("span",{className:"margin-l--4",id:"text-card-nomination-interval"})])),o.push(i.a.build("span",{className:s,id:"box-card-nomination-result"},[i.a.icon("&#xf00c"),i.a.build("span",{className:"margin-l--4"})]));const d=["object-fit: cover","object-position: center","width: 120px","min-width: 120px","height: 120px","min-height: 120px","border-top-left-radius: 4px"].join(";"),c=i.a.build("div",{},[i.a.build("div",{className:"flex-box-row--nowrap"},[i.a.build("img",{cssText:d,src:t.imageUrl,loading:"lazy"}),i.a.build("div",{className:["padding--8","flex-box--col","flex-align-items--start","flex-justify-content--start"].join(" ")},[i.a.build("span",{className:"mdc-typography--headline6",innerHTML:t.title}),i.a.build("div",{className:"mdc-typography--body2 flex-box-row--wrap"},o)])])]),u=i.a.build("button",{className:"mdc-button mdc-card__action mdc-card__action--button"},[i.a.build("div",{className:"mdc-button__ripple"}),i.a.build("i",{className:"fa fa-fw mdc-button__icon"}),i.a.build("span",{className:"mdc-button__label"})]),h=new l.a(u);h.unbounded=!0,h.listen("click",a.openDetails);const m=[];m.push(r.buildAction("ui.list-view.card.location","button-card-nomination-location","&#xf3c5",!0,a.focus)),n.a.version.full&&m.push(r.buildAction("ui.list-view.card.intelMap","button-card-nomination-intel","&#xf0ac",!0,(()=>window.open(t.intelUrl,"_blank","noopener")))),m.push(r.buildAction("ui.list-view.card.bsWatermeter","button-card-nomination-bs","&#xf5dc",n.a.bs.beforeCreate(t),a.openBs));return i.a.build("div",{className:"mdc-card mdc-card--outlined flex-shrink--0",id:"card-"+t.id},[c,i.a.build("div",{className:"mdc-card__actions"},[i.a.build("div",{className:"mdc-card__action-buttons"},[u]),i.a.build("div",{className:"mdc-card__action-icons"},m)])])}static buildAction(t,e,a,n,o){const r=i.a.build("button",{className:["fa","mdc-icon-button","mdc-card__action","mdc-card__action--icon"].join(" "),title:s.a.t(t),id:e,hidden:n,innerHTML:a}),d=new l.a(r);return d.unbounded=!0,d.listen("click",o),r}static update(t,e){const a=e.querySelector("#box-card-nomination-result"),i=n.a.status.getTypeByCode(t.status.code);e.querySelector("#text-card-nomination-interval").innerHTML=t.intervalString,t.status.code>0?(a.hidden=!1,a.querySelector("i").innerHTML=n.a.status.types.get(i).icon,a.querySelector("span").innerHTML=t.resultDateString):a.hidden=!0;const o=e.querySelector(".mdc-card__action-buttons > button");o.className="mdc-button mdc-card__action mdc-card__action--button status-"+i,o.querySelector("i").innerHTML=t.status.icon,o.querySelector("span").innerHTML=s.a.t(t.status.title);e.querySelector("#button-card-nomination-bs").hidden=n.a.bs.beforeCreate(t)}static updateLocation(t,e){const a=!t.lngLat;if(e.querySelector("#button-card-nomination-location").hidden=a,!n.a.version.full)return;e.querySelector("#button-card-nomination-intel").hidden=a}}var d=r;class c extends o.a{constructor(){super(...arguments),this.root=null,this.now=Date.now(),this.events={alert:()=>{},focus:()=>{},openDetails:()=>{}}}init(t){super.init(t),this.render()}render(){this.root=i.a.build("div",{className:["flex--1","flex-box-col","view-hide"].join(" "),cssText:["height: 100%","min-width: 300px","padding: 4px","box-sizing: border-box","overflow-y: auto","scroll-behavior: smooth","-webkit-overflow-scrolling: touch"].join(";")}),this.parent.append(this.root)}clear(){this.root.innerHTML=""}show(t){this.clear();const e=t.map((t=>{const e=d.build(t,this.now,{focus:()=>{this.events.focus(t)},openBs:()=>{if(n.a.version.full)window.open(t.bsUrl,"_blank","noopener");else{const e=i.a.build("textarea",{value:t.id,readOnly:!0});document.body.append(e),e.select(),document.execCommand("copy"),e.remove(),this.events.alert(s.a.t("message:ui.list-view.bsIdCopied",{id:t.id}))}},openDetails:()=>this.events.openDetails(t)});return d.update(t,e),t.lngLat&&d.updateLocation(t,e),e}));this.root.append(...e)}update(t,e){const a=this.root.querySelector("#card-"+t.id);d.update(t,a),d.updateLocation(t,a),a.hidden=!e}}e.default=c},69:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return r})),a.d(e,"AppBarMenuItems",(function(){return l.a}));var s=a(3),i=a(62),n=a(1),o=a(5),l=a(17);class r extends o.a{constructor(){super(...arguments),this.ctrl=null,this.items=new Map,this.events=new Map}init(t){super.init(t),this.render()}render(){const t=n.a.build("ul",{className:"mdc-list",role:"menu",ariaOrientation:"vertical"});for(const e of Object.values(l.a)){const a=n.a.build("li",{className:"mdc-list-item",role:"menuitem",dataset:{code:e.key},hidden:!0},[n.a.build("span",{className:"mdc-list-item__text",innerHTML:s.a.t(e.title)})]);this.items.set(e.key,a),t.append(a)}this.items.get(l.a.about.key).hidden=!1;const e=n.a.build("div",{className:"mdc-menu mdc-menu-surface"},[t]),a=n.a.build("div",{className:"mdc-menu-surface--anchor"},[e]);this.parent.append(a),this.ctrl=new i.a(e),this.ctrl.listen("MDCMenu:selected",(t=>{this.events.get(t.detail.item.dataset.code)()}))}open(){this.ctrl.open||(this.ctrl.open=!0)}}},70:function(t,e,a){"use strict";a.r(e);var s=a(3),i=a(38),n=a(61),o=a(1),l=a(8);class r extends l.a{constructor(){super(...arguments),this.textField=null,this.import=()=>{}}render(){const t=o.a.build("div",{className:["mdc-text-field","mdc-text-field--outlined","mdc-text-field--textarea","mdc-text-field--fullwidth"].join(" ")},[o.a.build("textarea",{className:"mdc-text-field__input code",id:"input-dialog-import-wayfarer",rows:8,cols:80}),o.a.build("div",{className:"mdc-notched-outline"},[o.a.build("div",{className:"mdc-notched-outline__leading"}),o.a.build("div",{className:"mdc-notched-outline__notch"},[o.a.build("label",{className:"mdc-floating-label",for:"input-dialog-import-wayfarer",innerHTML:s.a.t("ui.dialog.import.json")})]),o.a.build("div",{className:"mdc-notched-outline__trailing"})])]),e=l.a.buildDialog([o.a.build("h2",{className:"mdc-dialog__title",innerHTML:s.a.t("ui.dialog.import.title")}),o.a.build("div",{className:"mdc-dialog__content"},[t,o.a.build("div",{className:"mdc-text-field-helper-line"},[o.a.build("div",{className:"mdc-text-field-helper-text mdc-text-field-helper-text--persistent"},[s.a.t("ui.dialog.import.from"),l.a.buildLink("https://wayfarer.nianticlabs.com/api/v1/vault/manage",s.a.t("ui.dialog.import.wayfarer"),s.a.t("ui.dialog.import.wayfarer"))])])]),o.a.build("footer",{className:"mdc-dialog__actions"},[l.a.buildDialogAction("close",s.a.t("ui.dialog.close")),l.a.buildDialogAction("import",s.a.t("ui.dialog.import.import"))])]);this.parent.append(e),this.ctrl=new i.a(e),this.textField=new n.a(t),this.ctrl.listen("MDCDialog:closed",(t=>{"import"===t.detail.action&&this.import(this.textField.value)}))}open(){this.ctrl||this.render(),this.textField.value="",this.ctrl.open()}}e.default=r}}]);