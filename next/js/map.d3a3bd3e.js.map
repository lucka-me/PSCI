{"version":3,"sources":["webpack:///./src/views/NominationMap.vue","webpack:///./src/views/NominationMap.vue?db87","webpack:///./src/views/NominationMap.vue?5e45","webpack:///./src/views/NominationMap.vue?5372"],"names":["class","id","title","navi-back","this","commonSense","list","$store","state","nominations","filter","nomination","lngLat","predicator","$route","query","status","code","parseInt","umi","get","reason","scanner","then","mapboxgl","ctrl","Map","container","accessToken","style","resize","once","pourData","boundsNE","lng","lat","boundsSW","geoJSON","type","features","map","properties","geometry","coordinates","color","colorDark","addSource","data","cluster","addLayer","source","paint","layout","on","event","feature","clusterId","cluster_id","getSource","getClusterExpansionZoom","err","zoom","easeTo","center","Math","abs","Popup","setLngLat","setText","addTo","fitBounds","linear","padding","components","MaterialTopAppBar","MaterialTopAppBarAdjust","render"],"mappings":"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","file":"js/map.d3a3bd3e.js","sourcesContent":["<template>\n<material-top-app-bar :title=\"title\" navi-back/>\n<material-top-app-bar-adjust/>\n<main class=\"nomination-map\">\n    <div id=\"map-container\"/>\n</main>\n</template>\n\n<script lang=\"ts\">\nimport { Options, Vue } from 'vue-class-component';\nimport 'mapbox-gl/dist/mapbox-gl.css';\n\nimport Nomination from '@/service/nomination';\nimport { umi } from '@/service/umi';\n\nimport MaterialTopAppBar from '@/components/material/TopAppBar.vue';\nimport MaterialTopAppBarAdjust from '@/components/material/TopAppBarAdjust.vue';\n\n@Options({\n    components: {\n        MaterialTopAppBar, MaterialTopAppBarAdjust,\n    },\n})\nexport default class NominationMap extends Vue {\n\n    private ctrl?: mapboxgl.Map;\n\n    get title(): string {\n        return this.commonSense?.title ?? 'All';\n    }\n\n    get nominations(): Array<Nomination> {\n        let list = this.$store.state.nominations.filter((nomination) => nomination.lngLat);\n        const commonSense = this.commonSense;\n        if (commonSense) list = list.filter(commonSense.predicator);\n        return list;\n    }\n\n    private get commonSense(): umi.CommonSense | null {\n        if (this.$route.query.status && typeof(this.$route.query.status) === 'string') {\n            const code = parseInt(this.$route.query.status);\n            return umi.status.get(code) || null;\n        }\n        if (this.$route.query.reason && typeof(this.$route.query.reason) === 'string') {\n            const code = parseInt(this.$route.query.reason);\n            return umi.reason.get(code) || null;\n        }\n        if (this.$route.query.scanner && typeof(this.$route.query.scanner) === 'string') {\n            const code = parseInt(this.$route.query.scanner);\n            return umi.scanner.get(code) || null;\n        }\n        return null;\n    }\n\n    mounted() {\n        import(\n            /* webpackChunkName: 'mapbox' */\n            'mapbox-gl'\n        ).then((mapboxgl) => {\n            this.ctrl = new mapboxgl.Map({\n                container: 'map-container',\n                accessToken: 'pk.eyJ1IjoibHVja2EtbWUiLCJhIjoiY2p2NDk5NmRvMHFreTQzbzduemM1MHV4cCJ9.7XGmxnEJRoCDr-i5BBmBfw',\n                style: 'mapbox://styles/mapbox/outdoors-v11',\n            });\n            this.ctrl.resize();\n            this.ctrl.once('idle', () => {\n                this.pourData();\n            });\n        });\n    }\n\n    private pourData() {\n        if (!this.ctrl) return;\n        const nominations = this.nominations;\n        // Generate GeoJSON and get bounds\n        const boundsNE = { lng: -181.0, lat: -91.0 };\n        const boundsSW = { lng:  181.0, lat:  91.0 };\n        const geoJSON: GeoJSON.FeatureCollection<GeoJSON.Geometry> = {\n            type: 'FeatureCollection',\n            features: nominations.map((nomination) => {\n                const lngLat = nomination.lngLat!;\n                if (lngLat.lng > boundsNE.lng) boundsNE.lng = lngLat.lng;\n                if (lngLat.lng < boundsSW.lng) boundsSW.lng = lngLat.lng;\n                if (lngLat.lat > boundsNE.lat) boundsNE.lat = lngLat.lat;\n                if (lngLat.lat < boundsSW.lat) boundsSW.lat = lngLat.lat;\n                return {\n                    type: 'Feature',\n                    properties: { title: nomination.title },\n                    geometry: {\n                        type: 'Point',\n                        coordinates: [lngLat.lng, lngLat.lat],\n                    }\n                }\n            }),\n        };\n        const id = 'nominations';\n        const color = '#2578B5';\n        const colorDark = '#004D85';\n\n        // Add source and layers\n        this.ctrl.addSource(id, {\n            type: 'geojson',\n            data: geoJSON,\n            cluster: true,\n        });\n        this.ctrl.addLayer({\n            id: `${id}-cluster`,\n            type: 'circle',\n            source: id,\n            filter: ['has', 'point_count'],\n            paint: {\n                'circle-color': color,\n                'circle-opacity': 0.6,\n                'circle-stroke-width': 4,\n                'circle-stroke-color': colorDark,\n                'circle-radius': [\n                    'step', ['get', 'point_count'],\n                    20, 50,\n                    30, 100,\n                    40\n                ]\n            }\n        });\n        this.ctrl.addLayer({\n            id: `${id}-count`,\n            type: 'symbol',\n            source: id,\n            filter: ['has', 'point_count'],\n            layout: {\n                'text-field': '{point_count_abbreviated}',\n                'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],\n                'text-size': 12,\n            },\n            paint: {\n                'text-color': '#000',\n            }\n        });\n        this.ctrl.addLayer({\n            id: `${id}-unclustered`,\n            type: 'circle',\n            source: id,\n            filter: ['!', ['has', 'point_count']],\n            paint: {\n                'circle-color': color,\n                'circle-radius': 5,\n                'circle-stroke-width': 2,\n                'circle-stroke-color': colorDark\n            }\n        });\n\n        // Set listener\n        this.ctrl.on('click', `${id}-cluster`, event => {\n            if (!this.ctrl || !event.features) return;\n            const feature = event.features[0];\n            const clusterId = feature.properties!.cluster_id;\n            (this.ctrl.getSource(id) as mapboxgl.GeoJSONSource).getClusterExpansionZoom(\n                clusterId,\n                (err, zoom) => {\n                    if (!this.ctrl || err) return;\n                    this.ctrl.easeTo({\n                        center: (feature.geometry as GeoJSON.Point).coordinates as [number, number],\n                        zoom: zoom\n                    });\n                }\n            );\n        });\n\n        this.ctrl.on('click', `${id}-unclustered`, event => {\n            if (!this.ctrl || !event.features) return;\n            const feature = event.features[0];\n            const coordinates = (feature.geometry as GeoJSON.Point).coordinates as [number, number];\n            while (Math.abs(event.lngLat.lng - coordinates[0]) > 180) {\n                coordinates[0] += event.lngLat.lng > coordinates[0] ? 360 : -360;\n            }\n\n            import(\n                /* webpackChunkName: 'mapbox' */\n                'mapbox-gl'\n            ).then((mapboxgl) => {\n                if (!this.ctrl) return;\n                new mapboxgl.Popup()\n                    .setLngLat(coordinates)\n                    .setText(feature.properties!.title)\n                    .addTo(this.ctrl);\n            });\n        });\n\n        // Fit the bounds\n        if (boundsSW.lng > -181) {\n            this.ctrl.fitBounds([boundsSW, boundsNE], { linear: true, padding: 16 });\n        }\n    }\n}\n</script>\n\n<style lang=\"scss\">\nbody {\n    margin: 0;\n}\n\n.nomination-map {\n    margin: 0;\n    display: flex;\n    flex-flow: column nowrap;\n\n    > #map-container {\n        width: 100%;\n        height: 30rem;\n    }\n}\n</style>","\nimport { Options, Vue } from 'vue-class-component';\nimport 'mapbox-gl/dist/mapbox-gl.css';\n\nimport Nomination from '@/service/nomination';\nimport { umi } from '@/service/umi';\n\nimport MaterialTopAppBar from '@/components/material/TopAppBar.vue';\nimport MaterialTopAppBarAdjust from '@/components/material/TopAppBarAdjust.vue';\n\n@Options({\n    components: {\n        MaterialTopAppBar, MaterialTopAppBarAdjust,\n    },\n})\nexport default class NominationMap extends Vue {\n\n    private ctrl?: mapboxgl.Map;\n\n    get title(): string {\n        return this.commonSense?.title ?? 'All';\n    }\n\n    get nominations(): Array<Nomination> {\n        let list = this.$store.state.nominations.filter((nomination) => nomination.lngLat);\n        const commonSense = this.commonSense;\n        if (commonSense) list = list.filter(commonSense.predicator);\n        return list;\n    }\n\n    private get commonSense(): umi.CommonSense | null {\n        if (this.$route.query.status && typeof(this.$route.query.status) === 'string') {\n            const code = parseInt(this.$route.query.status);\n            return umi.status.get(code) || null;\n        }\n        if (this.$route.query.reason && typeof(this.$route.query.reason) === 'string') {\n            const code = parseInt(this.$route.query.reason);\n            return umi.reason.get(code) || null;\n        }\n        if (this.$route.query.scanner && typeof(this.$route.query.scanner) === 'string') {\n            const code = parseInt(this.$route.query.scanner);\n            return umi.scanner.get(code) || null;\n        }\n        return null;\n    }\n\n    mounted() {\n        import(\n            /* webpackChunkName: 'mapbox' */\n            'mapbox-gl'\n        ).then((mapboxgl) => {\n            this.ctrl = new mapboxgl.Map({\n                container: 'map-container',\n                accessToken: 'pk.eyJ1IjoibHVja2EtbWUiLCJhIjoiY2p2NDk5NmRvMHFreTQzbzduemM1MHV4cCJ9.7XGmxnEJRoCDr-i5BBmBfw',\n                style: 'mapbox://styles/mapbox/outdoors-v11',\n            });\n            this.ctrl.resize();\n            this.ctrl.once('idle', () => {\n                this.pourData();\n            });\n        });\n    }\n\n    private pourData() {\n        if (!this.ctrl) return;\n        const nominations = this.nominations;\n        // Generate GeoJSON and get bounds\n        const boundsNE = { lng: -181.0, lat: -91.0 };\n        const boundsSW = { lng:  181.0, lat:  91.0 };\n        const geoJSON: GeoJSON.FeatureCollection<GeoJSON.Geometry> = {\n            type: 'FeatureCollection',\n            features: nominations.map((nomination) => {\n                const lngLat = nomination.lngLat!;\n                if (lngLat.lng > boundsNE.lng) boundsNE.lng = lngLat.lng;\n                if (lngLat.lng < boundsSW.lng) boundsSW.lng = lngLat.lng;\n                if (lngLat.lat > boundsNE.lat) boundsNE.lat = lngLat.lat;\n                if (lngLat.lat < boundsSW.lat) boundsSW.lat = lngLat.lat;\n                return {\n                    type: 'Feature',\n                    properties: { title: nomination.title },\n                    geometry: {\n                        type: 'Point',\n                        coordinates: [lngLat.lng, lngLat.lat],\n                    }\n                }\n            }),\n        };\n        const id = 'nominations';\n        const color = '#2578B5';\n        const colorDark = '#004D85';\n\n        // Add source and layers\n        this.ctrl.addSource(id, {\n            type: 'geojson',\n            data: geoJSON,\n            cluster: true,\n        });\n        this.ctrl.addLayer({\n            id: `${id}-cluster`,\n            type: 'circle',\n            source: id,\n            filter: ['has', 'point_count'],\n            paint: {\n                'circle-color': color,\n                'circle-opacity': 0.6,\n                'circle-stroke-width': 4,\n                'circle-stroke-color': colorDark,\n                'circle-radius': [\n                    'step', ['get', 'point_count'],\n                    20, 50,\n                    30, 100,\n                    40\n                ]\n            }\n        });\n        this.ctrl.addLayer({\n            id: `${id}-count`,\n            type: 'symbol',\n            source: id,\n            filter: ['has', 'point_count'],\n            layout: {\n                'text-field': '{point_count_abbreviated}',\n                'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],\n                'text-size': 12,\n            },\n            paint: {\n                'text-color': '#000',\n            }\n        });\n        this.ctrl.addLayer({\n            id: `${id}-unclustered`,\n            type: 'circle',\n            source: id,\n            filter: ['!', ['has', 'point_count']],\n            paint: {\n                'circle-color': color,\n                'circle-radius': 5,\n                'circle-stroke-width': 2,\n                'circle-stroke-color': colorDark\n            }\n        });\n\n        // Set listener\n        this.ctrl.on('click', `${id}-cluster`, event => {\n            if (!this.ctrl || !event.features) return;\n            const feature = event.features[0];\n            const clusterId = feature.properties!.cluster_id;\n            (this.ctrl.getSource(id) as mapboxgl.GeoJSONSource).getClusterExpansionZoom(\n                clusterId,\n                (err, zoom) => {\n                    if (!this.ctrl || err) return;\n                    this.ctrl.easeTo({\n                        center: (feature.geometry as GeoJSON.Point).coordinates as [number, number],\n                        zoom: zoom\n                    });\n                }\n            );\n        });\n\n        this.ctrl.on('click', `${id}-unclustered`, event => {\n            if (!this.ctrl || !event.features) return;\n            const feature = event.features[0];\n            const coordinates = (feature.geometry as GeoJSON.Point).coordinates as [number, number];\n            while (Math.abs(event.lngLat.lng - coordinates[0]) > 180) {\n                coordinates[0] += event.lngLat.lng > coordinates[0] ? 360 : -360;\n            }\n\n            import(\n                /* webpackChunkName: 'mapbox' */\n                'mapbox-gl'\n            ).then((mapboxgl) => {\n                if (!this.ctrl) return;\n                new mapboxgl.Popup()\n                    .setLngLat(coordinates)\n                    .setText(feature.properties!.title)\n                    .addTo(this.ctrl);\n            });\n        });\n\n        // Fit the bounds\n        if (boundsSW.lng > -181) {\n            this.ctrl.fitBounds([boundsSW, boundsNE], { linear: true, padding: 16 });\n        }\n    }\n}\n","import { render } from \"./NominationMap.vue?vue&type=template&id=712e615c\"\nimport script from \"./NominationMap.vue?vue&type=script&lang=ts\"\nexport * from \"./NominationMap.vue?vue&type=script&lang=ts\"\n\nimport \"./NominationMap.vue?vue&type=style&index=0&id=712e615c&lang=scss\"\nscript.render = render\n\nexport default script","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./NominationMap.vue?vue&type=style&index=0&id=712e615c&lang=scss\""],"sourceRoot":""}